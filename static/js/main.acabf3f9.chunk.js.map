{"version":3,"sources":["ecosphere/utils/where.ts","ecosphere/utils/isString.ts","collections/Map.ts","collections/List.ts","collections/Sequence.ts","ecosphere/Stocks.ts","ecosphere/Registry.ts","ecosphere/Delta.ts","ecosphere/Model/Simulation.ts","ecosphere/Collection.ts","ecosphere/utils/randomInteger.ts","ecosphere/utils/sample.ts","ecosphere/types/index.ts","ecosphere/Population.ts","ecosphere/Community.ts","ecosphere/Model/Model.ts","ecosphere/Model/presentItem.tsx","ecosphere/View/Tile.tsx","ecosphere/View/presentCommunity.tsx","ecosphere/View/presentIndividual.tsx","ecosphere/View/View.tsx","ecosphere/Model/index.ts","ModelPresenter.tsx","useModel.tsx","ModelSelector.tsx","examples/Avernus.ts","examples/Arena/MonsterManual.ts","examples/Arena/PlayerHandbook.ts","examples/Arena/index.ts","examples/Society.ts","examples/Factory.ts","ecosphere/utils/unique.ts","examples/zep.tsx","examples/index.ts","App.tsx","index.tsx"],"names":["where","key","value","it","isString","String","Map","idFor","nameFor","lookup","_data","k","v","this","namesAndValues","Object","entries","map","Number","fromEntries","List","items","count","length","push","filter","item","cb","forEach","fn","Error","Sequence","StockManager","stocks","stockId","amount","add","name","remove","list","lookupById","Stocks","elements","ids","storage","attrs","attributes","has","manage","id","next","theEntity","setAmount","element","find","matching","create","flatMap","manageAll","boundMethod","Registry","popCtor","populations","species","values","x","hasOwnProperty","theSpecies","population","populationList","pop","Delta","model","getStocks","changes","baseline","_store","Simulation","ticks","tracking","dynamics","e","flux","target","report","source","theDelta","manager","_delta","theFlows","flow","table","entry","t","flows","each","dynamism","apply","changed","flowsReport","delta","updated","deltaAmount","Collection","randomInteger","min","max","Math","floor","random","sample","ts","animalIds","createAnimal","kind","age","health","spirit","cunning","agility","strength","moietyIds","personId","human","size","SetHelper","set","populationIds","Population","individuals","Set","theList","individual","first","theIndividual","newborn","doomed","destroy","newborns","i","birth","doneFor","death","build","delete","Community","moieties","obscured","recipes","jobs","worker","inventories","person","get","personAttrs","moiety","inventory","traits","body","mind","insight","depth","education","disposition","soul","wit","empathy","integrity","beauty","currency","things","createPerson","wealth","sophistication","power","knowledge","createMoiety","resources","recipe","produce","mayProduce","consumes","resource","produces","Model","people","machines","animals","metrics","actions","policies","currentPolicy","clear","actionName","args","action","act","policyName","policy","presentItem","deltas","title","className","data-testid","Tile","children","presentCommunity","community","aria-label","work","itemNames","thing","sort","a","b","style","display","trait","View","modelName","communities","lastChanges","folks","keys","view","ModelPresenter","send","choose","step","onClick","type","checked","onChange","useModel","initialModel","useState","setModel","setLastChanges","delay","setDelay","shouldStep","shouldSend","doSend","shouldManage","doManage","command","setCommand","setPolicy","useEffect","isModel","callback","savedCallback","useRef","current","tick","setInterval","clearInterval","useInterval","performSend","performChoose","maybeModel","AssemblyPresenter","assembly","models","theModel","ModelSelector","options","placeholder","give","recipient","supplier","n","world","miner","minter","smelter","fisherman","mineGold","smeltGold","mintCoin","evolve","MonsterManual","basicCreatures","hp","evasion","reflect","speed","challengingCreatures","Gremlin","counter","Goblin","Kobold","Orc","uncommonCreatures","Rat","Bat","Snake","Blob","Bear","Ghost","absorb","defense","Rogue","Troll","regen","Giant","bosses","Priest","heal","Vampire","Drake","Lich","extraplanar","Demon","Angel","Archdemon","Dracolith","Archangel","dragons","rareCreatures","Leviathan","bestiary","basicSubtypes","Hostile","Intimidating","Nimble","Quick","Timid","Spry","Vigilant","Relentless","Armored","Hardened","Benevolent","Protective","Snarling","Emboldened","rareSubtypes","Elusive","Voracious","Vicious","Vexatious","Arrogant","Adventurous","Questing","Silvered","Mirrored","Aggressive","Dominating","Swift","Accelerated","Reluctant","Hidden","Invisible","Resurrecting","Regenerating","Fortified","Angelic","Prismatic","Pugnacious","Augmented","Skillful","Skeletal","Undead","Zombie","Favored","Fiendish","Fierce","Opalescent","Cruel","Vortex","evade","Shadow","Luminous","Defiant","Devious","Draconic","subtypes","Common","Evasive","Retaliatory","Inspired","Infused","Radiant","Resplendent","Heavy","Titanic","Unholy","Blessed","Adept","perks","Piercing","Enchanted","Clockwork","Phantasmal","Cosmic","Imperious","monsterIds","difficulty","creature","base","cr","generateBasicMonster","join","adjustedCr","crFactor","perk","PlayerHandbook","hero","characterClass","template","characterClasses","attr","baseStartingHp","levelUp","pc","attributeBoosts","common","uncommon","rare","epic","legendary","rarity","levelAttr","console","log","perkLevels","includes","Fighter","perkBenefits","Brutality","Counterweight","Efferverscence","Efficacious","Opalescence","Ethereal","Faith","Finesse","Fitness","Fluidity","Dexterity","Precision","Swiftness","Rapidity","Medic","Vitality","Whirlwind","Focus","Iridescence","Concentration","Salvation","DungeonMasterGuide","durations","round","day","arena","events","eventIds","challengeRating","heroIds","metricGrain","manual","spawnHero","spawnEnemyParty","enemyName","at","party","generate","totalLevels","adv","reduce","recentEvents","totalInjuryAmount","recent","injury","enemy","enemies","defender","aggressor","reflected","damage","enemyInjured","effective","absorption","injure","strike","attribute","multiplier","benefits","ranks","benefit","holyDefense","holyDamage","magicDefense","magicDamage","physicalDamage","criticalStrike","baseDamage","bonus","critChance","overallDamage","aggressors","defenders","aggSpeed","damageAll","hit","chainChance","maxChain","chain","healee","maxHeal","unit","adventurer","xp","gil","per","level","levelCost","pow","stock","encounterChance","turnStarted","attack","mortalityCheck","Society","resourceNames","animalNames","treeNames","fruitTreeNames","plantNames","strataNames","meatNames","setup","strata","socialClass","animal","tree","fruitTree","plant","evolution","animalName","randomTree","farmer","randomAnimal","randomPlant","Factory","bills","deliveryRate","fulfillmentEvents","canProduce","workers","required","requirement","producingRequirement","missingRequirements","missing","orderIds","event","message","description","deliverTo","order","receive","reset","firstUnfulfilled","unfulfilled","produceUnfulfilled","allBillsRequested","arr","u","l","unique","bill","nextUnfulfilled","undefined","orderItemNames","itemName","account","price","emit","warn","factory","reboot","product","managers","Avernus","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.acabf3f9.chunk.js","sourcesContent":["export function where(key: string, value: any) {\n  return (it: any) => it[key] === value;\n}\n","export function isString(value: any): value is string {\n  return typeof value === 'string' || value instanceof String;\n}\n","import { IMap } from \"./types\";\nexport class Map<K, V> implements IMap<K, V> {\n  _data: { [id: number]: V; } = {};\n  constructor(\n    private idFor: (k: K) => number,\n    private nameFor: (k: K) => string,\n    private lookup: (id: number) => K,\n  ) { }\n  set(k: K, v: V) { this._data[this.idFor(k)] = v; }\n  get(k: K): V { return this._data[this.idFor(k)]; }\n  get report(): { [name: string]: V } {\n    const namesAndValues = Object.entries(this._data)\n      .map(([k, v]) => [this.nameFor(this.lookup(Number(k))), v]);\n    return Object.fromEntries(namesAndValues);\n  }\n}\n","//\n\nimport { IList } from \"./types\";\n\nexport class List<T> implements IList<T> {\n  items: T[] = [];\n  protected get it() { return this.items; }\n  get first(): T { return this.items[0]; }\n  get last(): T { return this.items[this.count - 1]; }\n  get count(): number { return this.items.length; }\n  add(it: T) { this.items.push(it); }\n  remove(it: T) { this.items = this.items.filter(item => item !== it); }\n  each(cb: (it: T) => any) { this.items.forEach(cb); }\n  clear() { this.items = []; }\n  map<U>(fn: (it: T) => any): U[] { return this.items.map(fn) }\n\n  get sample(): T {\n    throw new Error('Method not implemented.');\n  }\n}\n","import { ISequence } from \"./types\";\n\nexport class Sequence implements ISequence<number> {\n  count = 0;\n  get next(): number { return this.count++; }\n}\n","import { BasicEntity } from \"./types/BasicEntity\";\nimport { boundMethod } from 'autobind-decorator'\nimport { where } from \"./utils/where\";\nimport { isString } from \"./utils/isString\";\nimport { ManageStock, ManageStocks } from \"./types\";\nimport { Sequence } from \"../collections\";\n\nclass StockManager<T extends BasicEntity> implements ManageStock<T> {\n  constructor(private stocks: Stocks<T>, private stockId: number) {}\n  add(amount: number): void { return this.stocks.add(amount, this.name) }\n  remove(amount: number): void { return this.stocks.remove(amount, this.name) }\n  get list(): T[] { return this.stocks.list() }\n  get count(): number { return this.stocks.count(this.name) }\n  get name() { return this.item.name }\n  get item(): T { return this.stocks.lookupById(this.stockId) }\n}\n\nexport class Stocks<T extends BasicEntity> {\n  private ids: Sequence = new Sequence()\n  private storage: { [key: number]: number; } = {}\n\n  constructor(\n    public name: string,\n    private elements: T[] = []\n  ) { }\n\n  @boundMethod\n  list() { return this.elements }\n\n  get _store() { return this.storage }\n\n  public clear() { this.elements = []; this.storage = {} }\n\n  public create(name: string): ManageStock<T>\n  public create(attributes: { name: string } & Omit<T, 'id' | 'name'>): ManageStock<T>\n  /** Create a new type of element to store */\n  @boundMethod\n  public create(attrs: any) {\n    let name: string | null = null;\n    let attributes: Partial<T> = {}\n    if (isString(attrs)) {\n      name = attrs;\n      attributes.name = name;\n    } else {\n      ({ name, ...attributes } = attrs);\n    }\n    if (isString(name) && this.has(name)) {\n      return this.manage(name);\n    }\n    if (!isString(name)) { throw new Error(\"Name must be a string\") }\n    // const elementIds: number[] = this.list().map(({ id }) => id);\n    const id = this.ids.next; //Math.max(0, ...elementIds) + 1;\n    const theEntity: T = { id, name, ...attributes } as T\n    this.list().push(theEntity);\n    const manage: ManageStock<T> = this.manage(name as string)\n    return manage\n  }\n\n  @boundMethod\n  add(amount: number, name: string) {\n    this.setAmount(name, this.count(name) + amount);\n  }\n\n  @boundMethod\n  remove(amount: number, name: string): void {\n    this.setAmount(name, this.count(name) - amount);\n  }\n\n  @boundMethod\n  zero(name: string): void {\n    this.setAmount(name, 0);\n  }\n\n  @boundMethod\n  count(name: string): number {\n    const element: T = this.lookup(name);\n    const amount = this.storage[element.id] || 0;\n    return amount;\n  }\n\n  has(name: string): boolean {\n    const matching = this.elements.find(where('name', name))\n    return !!matching;\n  }\n\n  @boundMethod\n  lookupById(id: number): T {\n    const matching = this.elements.find(where('id', id))\n    if (matching) {\n      return matching as T;\n    }\n    throw new Error(`No such ${this.name} with id ${id}`);\n  }\n\n  lookup(name: string): T {\n    const matching = this.elements.find(where('name', name))\n    if (matching) {\n      return matching as T;\n    } else {\n      return this.create(name).item\n    }\n  }\n\n  get report(): (T & { amount: number })[] {\n    const items: T[] = this.list()\n    const table = items.flatMap((item: T) => {\n      const id = Number(item.id)\n      const amount = this.storage[id] || 0\n      return { ...item, amount }\n    })\n    return table\n  }\n\n  manage(name: string): ManageStock<T> {\n    return new StockManager<T>(this, this.lookup(name).id)\n  }\n\n  manageAll(): ManageStocks {\n    const { add, remove, count } = this\n    return { add, remove, count, list: () => this.elements }\n  }\n\n  get manager() { return this.manageAll() }\n\n  private setAmount(name: string, amount: number): void {\n    const element: T = this.lookup(name);\n    this.storage[element.id] = amount;\n  }\n}\n","import { Population } from \"./Population\";\nimport { BasicEntity } from \"./types/BasicEntity\";\nimport { Entity, ManageStocks } from \"./types\";\nimport { boundMethod } from \"autobind-decorator\";\n\n// eg map animal (species) names to populations of individual animals...\n\nexport class Registry<U extends BasicEntity, T extends Entity<U>, Pop extends Population<U,T>> {\n  populations: { [species: string]: Pop } = {};\n  species: { [species: string]: U } = {}\n  constructor(\n    public name: string,\n    public popCtor: new (name: string, specie: U) => Pop\n  ) {}\n\n  clear() {\n    this.populations = {}\n  }\n\n  @boundMethod\n  lookup(name: string): Pop {\n    if (this.has(name)) {\n      return this.populations[name];\n    } else {\n      throw new Error(`No such ${this.name} '${name}'`);\n    }\n  }\n\n  @boundMethod\n  lookupById(id: number): U { //Population<U,T> {\n    const matching = Object.values(this.species).find(x => x.id === id)\n    if (matching) { //this.has(name)) {\n      return matching\n      // return this.populations[name];\n    } else {\n      throw new Error(`No such ${this.name} '${id}'`);\n    }\n  }\n\n  has(name: string): boolean {\n    return this.populations.hasOwnProperty(name);\n  }\n\n  @boundMethod\n  count(name: string): number {\n    return this.lookup(name).count;\n  }\n\n  @boundMethod\n  list(): U[] {\n    return Object.values(this.species)\n  }\n\n  listByName(name: string): T[] {\n    return this.lookup(name).list();\n  }\n\n  @boundMethod\n  create(name: string, species?: Omit<U, 'name' | 'id'>): Pop { //Population<U,T> {\n    if (this.has(name)) {\n      return this.lookup(name);\n    }\n    let theSpecies: U = { ...species, name, id: this.list().length+1 } as unknown as U; // species.kind points back to name...\n    let population: Pop = new this.popCtor(name, theSpecies);\n    this.populations[name] = population;\n    this.species[name] = theSpecies;\n    return population;\n  }\n\n  get populationList(): Population<U,T>[] { return Object.values(this.populations)}\n\n  get report() {\n    const pops = this.populationList.flatMap((population: Population<U,T>) => {\n      const pop = population\n      if (pop.count > 0) {\n        return { name: pop.name, amount: pop.count}\n      } else {\n        return []\n      }\n    })\n    return pops\n  };\n\n  @boundMethod\n  add(amount: number, name: string): void {\n    this.lookup(name).add(amount)\n  };\n\n  @boundMethod\n  remove(amount: number, name: string): void {\n    this.lookup(name).remove(amount)\n  };\n\n  manageAll(): ManageStocks {\n    const { add, remove, count, list } = this\n    return { add, remove, count, list }\n  }\n  get manager() { return this.manageAll() }\n}\n","import { Model } from \"./Model\";\nimport { Registry } from \"./Registry\";\nimport { Stocks } from \"./Stocks\";\nexport type DeltaSource = Stocks<any> | Registry<any, any, any> \n//<U extends BasicEntity, T extends Entity<U>> = Stocks<T> | Registry<U,T>\nexport type DeltaSourceManager = { add: Function, remove: Function, count: Function, list: Function }\nexport class Delta {\n  public changes: Stocks<any>;\n  constructor(public model: any, public getStocks: (model: Model) => DeltaSource) {\n    let baseline = this.getStocks(model)\n    this.changes = new Stocks(`${baseline.name} (delta)`, baseline.list());\n  }\n  get storage() { return this.changes._store }\n  // evolve(t: number): Delta {\n  //   let stocks = this.getStocks(this.model)\n  //   const flow = { [stocks.name]: stocks.manageAll() }\n  //   this.model.dynamics.each(dynamism => dynamism(flow, t));\n  //   return this;\n  // }\n}\n","import { List } from \"../../collections\";\nimport { Delta, DeltaSource } from \"../Delta\";\nimport { Entity, EvolvingStocks, TimeEvolution } from \"../types\";\nimport { ISimulation } from \"./ISimulation\";\n\nexport abstract class Simulation implements ISimulation {\n  protected ticks: number = 0;\n  protected tracking: string[] = []\n  public dynamics = new List<TimeEvolution>()\n  constructor(public name: string) { }\n  public evolve(e: TimeEvolution) { this.dynamics.add(e) }\n  public step() { return this.flux(this.ticks++) }\n\n  public get report() {\n    return Object.fromEntries(this.tracking.map(target =>\n      [target, (this as any)[target].report]\n    ))\n  }\n\n  private flow(target: string) {\n    const source = (this as any)[target]\n    const theDelta = new Delta(this, (model) => (model as any)[target])\n    const { add, remove } = theDelta.changes.manager\n    const { list, count, lookupById } = source\n    return { lookupById, _delta: theDelta, add, remove, list, count }\n  }\n  \n  private flows(): { [key: string]: { _delta: Delta, lookupById: Function, add: Function } } {\n    const theFlows: {[key: string]: any} = {}\n    this.tracking.forEach(target => theFlows[target] = this.flow(target))\n    return theFlows\n  }\n\n  private flowsReport(flow: { [s: string]: any }) {\n    const table: { [key: string]: any } = {}\n    Object.entries(flow).forEach(([name, flow]) => { \n      const theDelta = flow._delta\n      table[name] = Object.fromEntries(\n        Object\n          .entries(theDelta.storage)\n          .map(entry => {\n            const [id, amount] = entry\n            const name = flow.lookupById(Number(id)).name\n            return [ name, amount ]\n          })\n      )\n    })\n    return table\n  }\n\n  private flux(t: number) {\n    const flow: EvolvingStocks = this.flows() as any as EvolvingStocks\n    this.dynamics.each(dynamism => dynamism(flow, t));\n    Object.entries(flow).forEach(([name, flow]) => { \n      const theDelta = (flow as any)._delta\n      this.apply(theDelta, name)\n    })\n    return { changed: this.flowsReport(flow) }\n  }\n\n  private apply(delta: Delta, target: string) {\n    const source: DeltaSource = (this as any)[target] as DeltaSource\n    const manager = source.manager\n    const list = manager.list()\n    const { storage: updated } = delta;\n    const changed: { [elementName: string]: number; } = {};\n    list.forEach((item: Entity<any>) => {\n      if (updated[item.id]) {\n        const deltaAmount = updated[item.id];\n        manager.add(deltaAmount, item.name);\n        changed[item.name] = deltaAmount;\n      }\n    });\n    return { changed };\n  }\n}\n","import { List, Sequence } from \"../collections\";\nimport { IList } from \"../collections/types\";\nimport { BasicEntity } from \"./types/BasicEntity\";\n\nclass Collection<T extends BasicEntity> extends List<T> implements IList<T> {\n  list() { return this.items }\n  private ids = new Sequence()\n  get names(): string[] {\n    // throw new Error('Method not implemented.');\n    return this.items.map(item => item.name)\n  }\n  // private get ids() { return this.it.map(({ id }) => id) }\n  create(attributes: Partial<T>): T {\n    const id = this.ids.next;\n    const theEntity: T = { id, ...attributes } as unknown as T;\n    this.items.push(theEntity);\n    return theEntity\n  }\n\n  lookup(name: string) {\n    return this.items.find(it => it.name === name)\n  }\n}\n\nexport { Collection }\n","export function randomInteger(min: number, max: number) {\n  // return min + Math.floor(Math.random() * (max - min));\n  let result = Math.floor(Math.random() * (max - min + 1) + min)\n  // console.log(\"Random integer between \" + min + \" and \" + max + \": \" + result)\n  return result\n}\n","import { randomInteger } from \"./randomInteger\";\n\nexport function sample<T>(ts: T[]): T {\n  let i = randomInteger(0,ts.length-1)\n  return ts[i]; //randomInteger(0,ts.length-1)]\n\n}\n","import { Sequence } from \"../../collections\"\nimport { Stocks } from \"../Stocks\"\nimport { sample } from \"../utils/sample\"\nimport { BasicEntity } from \"./BasicEntity\"\n\nexport type Substance = BasicEntity\nexport type Entity<T> = BasicEntity & { kind: T }\n\nexport type Quality = 'terrible' | 'poor' | 'adequate' | 'good' | 'excellent'\ntype Size = 'fine' | 'small' | 'medium' | 'large' | 'huge'\nexport type Species = BasicEntity & {\n  name: string\n  size?: Size\n  fitness?: Quality\n}\n\nexport type Individual<T> = Entity<T> & {\n  age: number // maybe simpler to do bornAt?\n}\n\nexport type Creature<T> = Individual<T> & {\n  health: 'dying' | 'unwell' | 'flourishing' | 'triumphant'\n}\n\nexport type Animal = Creature<Species> & {\n  spirit: 'languorous' | 'vigorous' | 'impetuous' | 'ferocious'\n  strength: 'weak' | 'robust' | 'mighty' | 'indomitable'\n  cunning:  'dim' | 'attentive' | 'creative' | 'ingenious'\n  agility:  'clumsy' | 'nimble' | 'spry' | 'balletic'\n}\n\nconst animalIds = new Sequence()\nexport const createAnimal = (name: string, species: Species): Animal => {\n  return {\n    id: animalIds.next,\n    name,\n    kind: species,\n    age: 0,\n    health: sample(['dying', 'unwell', 'flourishing', 'triumphant']),\n    spirit: sample(['languorous', 'vigorous', 'impetuous', 'ferocious']),\n    cunning: sample(['dim', 'attentive', 'creative', 'ingenious']),\n    agility: sample(['clumsy', 'nimble', 'spry', 'balletic']),\n    strength: sample(['weak', 'robust', 'mighty', 'indomitable']),\n  }\n}\n\n// major demographic groupings -- moieties (maybe *this* should be called a Community??)\ntype Wealth = 'impoverished' | 'well-off' | 'luxuriant' | 'decadent'\ntype Sophistication = 'unpretentious' | 'savvy' | 'urbane' | 'sleek'\ntype Power = 'inconsequential' | 'marginal' | 'influential' | 'sovereign'\ntype Knowledge = 'clueless' | 'well-informed' | 'wise' | 'prescient'\n\nexport type Moiety = BasicEntity & {\n  wealth: Wealth\n  sophistication: Sophistication\n  power: Power\n  knowledge: Knowledge\n}\n\nconst moietyIds = new Sequence()\nexport const createMoiety = (name: string): Moiety => {\n  const wealth: Wealth = sample([ 'impoverished', 'well-off', 'luxuriant', 'decadent' ])\n  const sophistication: Sophistication = sample([ 'unpretentious', 'savvy', 'urbane', 'sleek' ])\n  const power: Power = sample([ 'inconsequential', 'marginal', 'influential', 'sovereign' ])\n  const knowledge: Knowledge = sample([ 'clueless', 'well-informed', 'wise', 'prescient' ])\n  return { id: moietyIds.next, name, wealth, sophistication, power, knowledge }\n}\n\ntype Body = Animal\n\ntype Insight = 'dense' | 'intuitive' | 'incisive' | 'brilliant'\ntype Depth = 'superficial' | 'substantial' | 'profound' | 'inscrutable'\ntype Education = 'unlettered' | 'literate' | 'tutored' | 'well-read'\ntype Disposition = 'dismal' | 'hopeful' | 'propitious' | 'roseate'\ntype Mind = {\n  insight: Insight\n  depth: Depth\n  education: Education\n  disposition: Disposition\n}\n\nexport const createMind = (): Mind => {\n  const insight: Insight = sample([ 'dense', 'intuitive', 'incisive', 'brilliant' ])\n  const depth: Depth = sample([ 'superficial', 'substantial', 'profound', 'inscrutable' ])\n  const education: Education = sample([ 'unlettered', 'literate', 'tutored', 'well-read' ])\n  const disposition: Disposition = sample([ 'dismal', 'hopeful', 'propitious', 'roseate' ])\n  return { insight, depth, education, disposition }\n}\n\ntype Wit = 'slow' | 'clever' | 'biting' | 'savage'\ntype Empathy = 'sadistic' | 'generous' | 'benevolent' | 'selfless'\ntype Integrity = 'uncertain' | 'sound' | 'solid' | 'incorruptible'\ntype Beauty = 'ugly' | 'fair' | 'radiant' | 'resplendent'\ntype Soul = {\n  wit: Wit\n  empathy: Empathy\n  integrity: Integrity\n  beauty: Beauty\n}\n\nexport const createSoul = (): Soul => {\n  const wit: Wit = sample([ 'slow', 'clever', 'biting', 'savage' ])\n  const empathy: Empathy = sample([ 'sadistic', 'generous', 'benevolent', 'selfless' ])\n  const integrity: Integrity = sample([ 'uncertain', 'sound', 'solid', 'incorruptible' ])\n  const beauty: Beauty = sample([ 'ugly', 'fair', 'radiant', 'resplendent' ])\n  return { wit, empathy, integrity, beauty }\n}\n\n// type Category = BasicEntity\n// type Item = Entity<Category> & {}\n// type Event = BasicEntity\n// type Incident = Entity<Incident>\n\n// export type Trait = { id: number, name: string, rank: 0 | 1 | 2 | 3 | 4 | 5 }\n\nexport type Person = Individual<Moiety> & {\n  body: Body\n  mind: Mind\n  soul: Soul\n\n\n  // ie within my moiety, I am (thought of as)...\n  // rank: 'commoner' | 'wellborn'\n  // title?: string\n  // reputation: 'unknown' | 'worthy' | 'adored' | 'revered'\n\n  // individually...\n  things: ManageStocks //Stocks<Item> // hmmm, maybe we really want a map at a higher-level anyway\n  // stats: ManageStocks //Stocks<Item> // hmmm, maybe we really want a map at a higher-level anyway\n\n  currency: number\n  traits: ManageStocks // IList<Trait>\n  // memory: List<Event>\n  // philosophy?: Ideology\n  // destiny: 'doomed' | 'commonplace' | 'exceptional' | 'free'\n}\n\nconst personId = new Sequence()\nconst human: Species = { id: -1, name: 'Human Being', size: 'medium' }\nexport const createPerson = (name: string, moiety: Moiety): Person => {\n\n  const inventory = new Stocks<any>(`${name}'s Things`)\n  const traits = new Stocks<any>(`${name}'s Traits`)\n  // const state = new Stocks<any>(`${name}'s State`)\n    // personAttrs.things = inventory.manageAll()\n  return {\n    id: personId.next,\n    kind: moiety,\n    // kind: createMoiety()\n    name,\n    age: 0,\n    body: createAnimal(name, human),\n    mind: createMind(),\n    soul: createSoul(),\n    // rank: 'commoner',\n    // reputation: 'unknown',\n    currency: 0,\n    things: inventory.manageAll(),\n    traits: traits.manageAll()\n    // stats: state.manageAll()\n    // things: new M\n  }\n\n}\n\n// const person = (): Person => {\n//   const newPerson: Person = {\n//     id: personId.next()\n//   }\n//   return newPerson\n// }\n\nexport type Recipe = BasicEntity & {\n  produces: { [resourceName: string]: number }\n  consumes?: { [resourceName: string]: number }\n  requiresMachine?: string\n}\n\nexport type Machine = BasicEntity\n\n// export type Task = BasicEntity & {\n//   machine?: string\n//   recipe: string\n// }\n\n// type ManageList = {}\n\nexport type ManageStocks = {\n  add: (amount: number, name: string) => void,\n  remove: (amount: number, name: string) => void,\n  count: (name: string) => number,\n  list: () => any[]\n}\n\nexport type ManageStock<T> = {\n  add: (amount: number) => void,\n  remove: (amount: number) => void,\n  count: number,\n  item: T\n}\n\nexport type ManagePopulation<T> = {\n  count: number\n  birth: (name: string) => T\n  death: (name: string) => T\n  add: (amount: number) => T[]\n  remove: (amount: number) => T[]\n}\n\nexport type ManagePopulationRegistry<T> = {\n  lookup: (name: string) => ManagePopulation<T>\n}\n\n// todo rename\nexport interface EvolvingStocks {\n  [key: string]: ManageStocks\n}\nexport type TimeEvolution = (evolution: EvolvingStocks, ticks: number) => void\n\nexport type StepResult = {\n  changed: { \n    [groupName: string]: { [elementName: string]: number }\n  }\n}\n\n// todo move these model/sim things somewhere else???\nexport type Action = { id: number, name: string, act: Function }\nexport type Policy = { id: number, name: string, manage: Function }\n","import { isString } from \"./utils/isString\";\nimport { boundMethod } from \"autobind-decorator\";\nimport { Entity } from \"./types\";\nimport { Sequence } from \"../collections\";\n\nclass SetHelper {\n  static first<T>(set: Set<T>): T { return set.values().next().value }\n}\n\n// a collection of named individuals...\nconst populationIds: Sequence = new Sequence()\nexport class Population<Specie, Dividual extends Entity<Specie>> {\n  public id = populationIds.next\n  private ids: Sequence = new Sequence()\n  constructor(\n    public name: string,\n    public species?: Specie,\n    protected individuals: Set<Dividual> = new Set(),\n  ) {}\n\n  list() { \n    const theList: Dividual[] = []\n    this.individuals.forEach(individual => theList.push(individual))\n    return theList;\n  }\n  get count() { return this.individuals.size }\n  get first() { \n    return SetHelper.first(this.individuals)\n   }\n  public lookup(name: string): Dividual {\n    let theIndividual = null;\n    this.individuals.forEach(individual => {\n      if (individual.name === name) {\n        theIndividual = individual;\n      }\n    });\n    if (theIndividual) { return theIndividual }\n    throw new Error(`Could not find individual with name '${name}' in the population of ${this.name}`)\n  }\n\n  @boundMethod\n  public lookupById(id: number): Dividual {\n    let theIndividual = null;\n    this.individuals.forEach(individual => {\n      if (individual.id === id) {\n        theIndividual = individual;\n      }\n    });\n    if (theIndividual) { return theIndividual }\n    throw new Error(`Could not find individual with id ${id} in the population of ${this.name}`)\n  };\n\n  public birth(name: string = `${this.name} ${this.count}`): Dividual {\n    const newborn = this.create(name)\n    return newborn\n  }\n\n  @boundMethod\n  public death(name?: string): Dividual {\n    if (name) {\n      const doomed = this.destroy(name)\n      if (doomed) {\n        return doomed\n      }\n    } else {\n      const doomed = this.first\n      if (doomed) {\n        this.destroy(doomed.name)\n        return doomed\n      }\n    }\n    throw new Error(\"Population already empty!\")\n  }\n\n  public add(amount: number) {\n    const newborns = []\n    for (let i = 0; i < amount; i++) {\n      newborns.push(this.birth())\n    }\n    return newborns\n  }\n\n  public remove(amount: number) {\n    const doneFor = []\n    for (let i = 0; i < Math.min(this.count, amount); i++) {\n      doneFor.push(this.death(this.first.name))\n    }\n    return doneFor\n  }\n\n  protected build(attrs: any) {\n    let name = null;\n    let attributes: Partial<Dividual> = {};\n    // console.log(attrs)\n    if (isString(attrs)) {\n      name = attrs;\n      attributes.name = name;\n    } else {\n      ({ name, ...attributes } = attrs);\n    }\n    \n    const id = this.ids.next; //Math.max(0, ...this.ids) + 1;\n    const theIndividual: Dividual = { id, name, ...attributes } as unknown as Dividual;\n    return theIndividual;\n  }\n\n\n  public create(name: string): Dividual;\n  public create(attrs: Partial<Dividual>): Dividual;\n  @boundMethod\n  public create(attrs: any) {\n    const theIndividual: Dividual = this.build(attrs)\n    this.individuals.add(theIndividual);\n    return theIndividual;\n  }\n\n  public destroy(name: string): Dividual;\n  @boundMethod\n  public destroy(name: string) {\n    const theIndividual: Dividual = this.lookup(name)\n    this.individuals.delete(theIndividual);\n    return theIndividual;\n  }\n\n  get report() {\n    return Object.fromEntries(this.list().map(individual => {\n      return [individual.id, individual.name];\n    }))\n  }\n}\n","import { List, Map } from '../collections';\nimport { Recipe, Moiety, Person, ManageStocks, createPerson, createMoiety } from \"./types\";\nimport { Population } from \"./Population\";\nimport { Collection } from \"./Collection\";\nimport { boundMethod } from 'autobind-decorator';\n\nexport class Community extends Population<Moiety, Person> {\n  moieties: List<Moiety> = new List<Moiety>();\n  obscured: boolean = false // don't display details\n   \n  public recipes = new Collection<Recipe>();\n  public jobs = new Map<Person, Recipe>(\n    worker => worker.id,\n    worker => worker.name,\n    this.lookupById\n  );\n\n  public inventories = new Map<Person, ManageStocks>(\n    worker => worker.id,\n    worker => worker.name,\n    this.lookupById\n  )\n\n  get report(): { [personName: string]: string; } {\n    const entries = this.list()\n      .map(person => [person.id, (this.jobs.get(person) || {name: '?'}).name]);\n    return Object.fromEntries(entries);\n  }\n\n  // okay if we need to override create + build inventories let's do it ??\n  public create(name: string): Person;\n  public create(attrs: Partial<Person>): Person;\n  @boundMethod\n  public create(attrs: any) {\n    const personAttrs = super.build(attrs);\n    const { name, age } = personAttrs;\n    const person: Person = createPerson(name, createMoiety(`${name}'s Gens`)) //, this.species)\n    person.age = age\n    this.individuals.add(person)\n    return person\n  }\n\n  // people have inventories...\n  // and maybe they've declared what they want\n\n  // measureTime(time: number): HumanCalendar {}\n\n  // trade({ resources })\n\n  work({ resources }: { resources: { add: Function; remove: Function; count: Function; }; }): void {\n    const { report } = this.jobs;\n    Object.entries(report).forEach(([_workerName, recipe]: [string, Recipe]) => {\n      this.produce(recipe, resources);\n    });\n  }\n  \n  private produce(recipe: Recipe, resources: { add: Function; remove: Function; count: Function; }) {\n    if (this.mayProduce(recipe, resources)) {\n      if (recipe.consumes) {\n        Object.entries(recipe.consumes).forEach(([resource, amount]) => {\n          resources.remove(amount, resource);\n        });\n      }\n      Object.entries(recipe.produces).forEach(([resource, amount]) => {\n        resources.add(amount, resource);\n      });\n    }\n  }\n\n  private mayProduce(recipe: Recipe, resources: { count: Function; }) {\n    let mayProduce = true;\n    if (recipe.consumes) {\n      Object.entries(recipe.consumes).forEach(([resource, amount]) => {\n        if (resources.count(resource) < amount) {\n          mayProduce = false;\n        }\n      });\n    }\n    return mayProduce;\n  }\n\n}\n","import { Substance, Machine, Animal, Species, Action, Policy, Moiety, Person } from \"../types\"\nimport { Stocks } from \"../Stocks\"\nimport { Registry } from \"../Registry\"\nimport { Simulation } from \"./Simulation\"\nimport { IModel } from \"./IModel\"\nimport { Collection } from \"../Collection\"\nimport { Community } from \"../Community\"\nimport { Population } from \"../Population\"\n\ntype Fauna = Population<Species, Animal>\nexport class Model extends Simulation implements IModel  {\n  tracking = [ 'animals', 'resources' ]\n\n  public people = new Registry<Moiety, Person, Community>('people', Community)\n  public resources = new Stocks<Substance>('resources')\n  public machines  = new Stocks<Machine>('machines')\n  public animals   = new Registry<Species, Animal, Fauna>('wildlife', Population)\n\n  reset() {\n    this.resources.clear()\n    this.machines.clear()\n    this.animals.clear()\n    this.people.clear()\n    this.dynamics.clear()\n  }\n\n  // measurements\n  public metrics: { [name: string]: () => number } = {}\n\n  // interactive elements\n  public actions: Collection<Action> = new Collection<Action>()\n  public policies: Collection<Policy> = new Collection<Policy>()\n\n  send(actionName: string, args: any): void {\n    const action = this.actions.lookup(actionName)\n\n    if (action) {\n      action.act(args)\n    } else {\n      throw new Error(`No such action ${actionName}`)\n    }\n  }\n\n  currentPolicy: Policy | undefined\n  choose(policyName: string): void {\n    // console.log(\"[Model.choose]\", policyName)\n    const policy = this.policies.lookup(policyName)\n    if (policy) {\n      this.currentPolicy = policy\n    } else {\n      throw new Error(`No such policy ${policyName}`)\n    }\n  }\n\n  public step() {\n    if (this.currentPolicy) {\n      // console.log(\"MANAGING\", { policy: this.currentPolicy })\n      this.currentPolicy.manage()\n    }\n    return super.step()\n  }\n}\n\nexport default Model;\n","import { prettyAmount } from \"../utils/prettyAmount\";\n\nexport function presentItem(deltas?: { [elementName: string]: number; }) {\n  return ({ name, amount }: { name: string; amount: number; }) => {\n    const delta = deltas && deltas[name];\n    return <li key={name} title={name} className='Item'>\n      <span className='Title' data-testid='Name'>{name}</span>\n      <span data-testid='Count'>\n        {prettyAmount(amount)}\n      </span>\n      <span data-testid='Delta'>\n        {delta}\n      </span>\n    </li>;\n  };\n}\n","export function Tile({ children, title }: { children?: React.ReactNode; title: string; }) {\n  return <div className='Tile' title={title}>\n    <h5 className='Title'>{title}</h5>\n    {children}\n  </div>;\n}\n","import { Tile } from \"./Tile\";\nimport { Community } from \"../Community\";\nimport { presentIndividual } from \"./presentIndividual\";\n\n\nexport function presentCommunity(community: Community) {\n  return <Tile title={community.name} key={community.id}>\n    <ul aria-label='People'>\n      {community.obscured ? community.list().map(individual => <li key={individual.id}>{individual.name}</li>)\n                          : community.list().map(presentIndividual(community.report))}\n    </ul>\n  </Tile>;\n}\n","import { ManageStocks } from \"../types\";\n\n\nexport function presentIndividual(work: { [key: number]: string; }) {\n  return ({ id, name, things, traits }: {\n    id: number;\n    name: string;\n    things: ManageStocks;\n    traits: ManageStocks;\n  }) => {\n    const itemNames = things.list().map(thing => thing.name);\n    return <li key={id} title={name} className='Item'>\n      <div className='Title' data-testid='Name'>{name}</div>\n      {work[id] && work[id] !== '?' && <span data-testid='Status'>{work[id]}</span>}\n      {itemNames.length > 0 && <div className='Subitems' data-testid='Inventory'>\n        <ul>\n          {itemNames.sort((a,b) => a > b ? 1 : -1).map(it => <li key={it} style={{\n              ...(things.count(it) === 0 ? { display: 'none' } : {})\n            }}>\n            {it} <span data-testid={it}  className='Count'>{things.count(it)}</span>\n          </li>)}\n        </ul>\n      </div>}\n\n      {traits.list().length > 0 && <div className='Traits' data-testid='Trait Ranks'>\n        <ul>\n          {traits.list().map(trait => <li key={trait.id} style={{\n              ...(traits.count(trait.name) === 0 ? { display: 'none' } : {})\n            }}>\n            {trait.name} <span data-testid={trait.name}>{traits.count(trait.name)}</span>\n          </li>)}\n        </ul>\n      </div>}\n\n    </li>;\n  };\n}\n","import { Machine, Moiety, Person } from \"../types\";\nimport { LastDelta } from \"../../ModelPresenter\";\nimport { presentItem } from \"../Model/presentItem\";\nimport './View.css';\nimport { Tile } from \"./Tile\";\nimport { presentCommunity } from \"./presentCommunity\";\nimport { Population } from \"../Population\";\nimport { Community } from \"../Community\";\n\nexport type ModelViewProps = {\n  modelName: string;\n  items: { name: string; amount: number; }[];\n  animals: { name: string; amount: number }[];\n  communities: Population<Moiety, Person>[];\n  machines: Machine[];\n  lastChanges: LastDelta;\n  metrics: { [name: string]: number }; //[ { name: string, value: number} ];\n}\n\nexport function View({\n  modelName,\n  items,\n  // individuals,\n  communities,\n  machines,\n  animals,\n  lastChanges,\n  metrics,\n  // work\n}: ModelViewProps) {\n  const folks = (communities as Community[]).map(presentCommunity)\n  // console.log({ community: communities[0].list() })\n  return <div className='Model'>\n    <h4 aria-label='Model Title' style={{display: 'none'}}>{modelName}</h4>\n    {items.length > 0 && (<Tile title='Items'>\n      <ul aria-label='Resources'>\n        {items.map(presentItem(lastChanges.resources))}\n      </ul>\n    </Tile>)}\n    {animals.length > 0 && (\n      <Tile title='Animals'>\n        <ul aria-label='Animals'>\n          {animals.map(presentItem(lastChanges.animals))}\n        </ul>\n      </Tile>)}\n      {communities.length > 0 && <div title='Individuals' style={{display: 'flex'}}>{folks}</div>}\n    {machines.length > 0 && <Tile title='Machines'>\n      <ul>\n        {machines.map(({ name }) => <li key={name}>{name}</li>)}\n      </ul>\n    </Tile>}\n    {Object.keys(metrics).length > 0 && <Tile title='Metrics'>\n      <ul>\n        {Object.entries(metrics).map(([name, value]) => <li title={name} key={name}>\n          {name}\n          <span data-testid='Count'>{value}</span>\n        </li>)}\n      </ul>\n    </Tile>}\n  </div>;\n}\n","import { Model } from './Model';\nimport { IModel } from './IModel';\nimport { View } from '../View/View';\nexport { Model, View as ModelView }\nexport type { IModel }\nexport default Model\n","// import { IAssembly } from './ecosphere/Assembly';\nimport { ModelView } from './ecosphere/Model';\nimport { IModel } from \"./ecosphere/Model/IModel\";\n\nexport type LastDelta = { [group: string]: { [element: string]: number }}\n\ntype ModelPresenterProps = {\n  model: IModel\n  step: Function \n  send: Function\n  choose: Function\n  lastChanges: LastDelta\n}\n\nconst view = (model: IModel, lastChanges: LastDelta) => {\n  const { actions, resources, people, machines, animals, metrics } = model;\n\n  const props = {\n    modelName: model.name,\n    items: resources.report,\n    communities: people.populationList, //.populations,\n    // individuals: people.list(),\n    // work: people.report,\n    machines: machines.list(),\n    animals: animals.report,\n    actions: actions.list(),\n    metrics: Object.fromEntries(\n      Object.entries(metrics).map(\n        ([key, value]) => [key, (value as any as Function)()])\n      ),\n    lastChanges,\n  }\n\n  return props\n}\n\nexport function ModelPresenter({ model, send, choose, step, lastChanges }: ModelPresenterProps) {\n  return <>\n    <div aria-label='View'>\n      <ModelView {...view(model, lastChanges)} />\n    </div>\n\n    <div aria-label='Controls'>\n      <span title='Run' style={{display: 'none'}}>\n        <button onClick={() => step(true)}>Step</button>\n      </span>\n\n      <span title='Actions'>\n        {model.actions.list().map(({ name }) => <button title={name} key={name} onClick={() => send(name)}>\n          {name}\n        </button>)}\n      </span>\n\n      {model.policies.count > 0 && <div className='Policy' title='Policies'>\n        {/* <h5>Policies</h5> */}\n        {model.policies.list().map(({ name }) => <label key={name}><input\n          type='radio'\n          checked={model.currentPolicy?.name === name}\n          title={name}\n          key={name}\n          onChange={() => choose(name)}\n        />\n        {name}\n        </label>)}\n      </div>}\n    </div>\n  </>;\n}\n","import { useState, useEffect, useRef } from 'react';\nimport { IAssembly } from './ecosphere/Assembly';\nimport { IModel } from \"./ecosphere/Model/IModel\";\nimport { LastDelta } from './ModelPresenter';\nimport { isModel } from './ModelSelector';\n\nexport type ModelAPI = {\n  model: IModel | IAssembly\n  setModel(model: IModel | IAssembly): void\n  step: Function,\n  lastChanges: LastDelta,\n  send: (actionName: string, args: any) => void,\n  choose: (policyName: string, args: any) => void,\n  setDelay: (milliseconds: number) => void\n}\n\n// ticks per sec\n// const ticksPerSecond = (n: number) => n > 0 ? Math.floor(1000 / n) : 1\n// const speeds = {slow: 10, fast: 25, faster: 50, fastest: 80};\nexport function useModel(initialModel: IModel | IAssembly): ModelAPI { //model: IModel = new Model('Hello World')): ModelAPI {\n  const [model, setModel] = useState(initialModel) //new Model('Hello World'))\n\n  const [lastChanges, setLastChanges] = useState({} as LastDelta)\n  const isTest = process.env.NODE_ENV === 'test'\n  const [delay, setDelay] = useState(isTest ? 5000 : 2) //ticksPerSecond(speeds.slow));\n\n  const [shouldStep, step] = useState(false);\n  const [shouldSend, doSend] = useState(false);\n  const [shouldManage, doManage] = useState(false)\n\n  const performStep = () => { step(true); };\n  const [command, setCommand] = useState('')\n  const [policy, setPolicy] = useState('')\n\n  useEffect(() => {\n    if (shouldSend) {\n      if (command && isModel(model)) { model.send(command, {}) }\n      doSend(false)\n    }\n  }, [command, model, shouldSend]);\n\n  useEffect(() => {\n    if (shouldManage) {\n      if (policy && isModel(model)) { model.choose(policy, {}) }\n      doManage(false)\n    }\n  }, [policy, model, shouldManage]);\n\n  const performSend = (actionName: string, args: any) => {\n    setCommand(actionName)\n    doSend(true)\n  }\n\n  const performChoose = (policyName: string, args: any) => {\n    // console.log(\"CHOOSE\", policyName)\n    setPolicy(policyName)\n    doManage(true)\n  }\n\n  useEffect(() => {\n    if (shouldStep && isModel(model)) {\n      let { changed } = model.step();\n      step(false);\n      setLastChanges(changed);\n    }\n  }, [shouldStep, model]);\n\n  useInterval(() => step(true), delay); \n\n  return {\n    model,\n    step: performStep,\n    lastChanges: lastChanges as LastDelta,\n    send: (actionName: string, args: any) => performSend(actionName, args), \n    choose: (policyName: string, args: any) => performChoose(policyName, args),\n    setDelay,\n    setModel,\n  };\n}\n\nfunction useInterval(callback: any, delay: number) {\n  const savedCallback = useRef();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      // @ts-ignore\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n}\n","import Dropdown from 'react-dropdown';\nimport 'react-dropdown/style.css';\nimport { IAssembly } from './ecosphere/Assembly';\nimport Model from './ecosphere/Model';\nimport { IModel } from \"./ecosphere/Model/IModel\";\nimport { ModelPresenter } from './ModelPresenter';\nimport { useModel } from './useModel';\n\nexport const isModel = (maybeModel: IModel | IAssembly): maybeModel is IModel => {\n  return maybeModel instanceof Model;\n}\n\nconst AssemblyPresenter: React.FC<{ assembly: IAssembly }> = ({ assembly }) => {\n  return <>{assembly.models.items.map((theModel: IModel) => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const { step, send, choose, lastChanges, model } = useModel(theModel);\n    return <>\n    <h4>{theModel.name}</h4>\n    <ModelPresenter\n             key={model.name}\n             step={step}\n             send={send}\n             model={model as IModel}\n             choose={choose}\n             lastChanges={lastChanges}\n           />\n           </>\n  })}</>\n}\n\nexport function ModelSelector({ initialModel, models }: {\n  initialModel: IModel;\n  models: (IModel | IAssembly)[];\n}) {\n  const { step, send, choose, lastChanges, model, setModel } = useModel(initialModel);\n  return <>\n    <Dropdown\n      options={models.map(model => model.name)}\n      onChange={({ value }) => {\n        const theModel = models.find((model: IModel | IAssembly) => model.name === value);\n        if (theModel) { setModel(theModel); }\n      }}\n      value={model.name}\n      placeholder=\"Select a model\" />\n    {isModel(model) ? <ModelPresenter\n                       step={step}\n                       send={send}\n                       model={model}\n                       choose={choose}\n                       lastChanges={lastChanges} />\n                    : <AssemblyPresenter assembly={model} />}\n  </>;\n}\n","// import Model from \"../ecosphere/Model\"\n\nimport Model from \"../ecosphere/Model\"\nimport { Person } from \"../ecosphere/types\"\n\nconst give = (recipient: Person, supplier: Person, n: number, item: string) => {\n  supplier.things.remove(n, item)\n  recipient.things.add(n, item)\n}\n\nconst world = new Model('Avernus')\nconst { resources, animals, people } = world\nconst folks = people.create('Townspeople')\nconst { recipes, jobs } = folks\n\nanimals.create('Fish')\n// resources.create('Fish')\n\n\n// const king = people.create('Maurice')\nconst miner = folks.create('Goldstrom')\nconst minter = folks.create('Octavius')\nconst smelter = folks.create('Smeltmore')\n// //const sheriff = people.create('Donald')\n// const claydigger = people.create('Bartlett')\n// const artist = people.create('Joseph')\nconst fisherman = folks.create('Harold')\n// const chef = people.create('Jethro')\n// const merchant = people.create('Reginald')\n\n// //set inventory\n// merchant.things.add(50, 'Gold Coin')\n\n\n// //create global resources\n// animals.create('Swimming Fish')\n// animals.add(500, 'Swimming Fish')\nresources.create('Gold Ore')\nresources.create('Gold Deposit')\nresources.create('Gold Bar')\nresources.create('Gold Coin')\n\nresources.add(100000000, 'Gold Deposit')\n// resources.create('Clay Deposit')\n// resources.add(10000, 'Clay Deposit')\n\n//create produced goods\n\n\n\n//jobs\n\n// const kingGold = recipes.create({\n//   name: 'Taking Gold',\n//   produces: { 'King Gold': 1 },\n//   consumes: { 'Gold Coin': 1 },\n// })\n\nconst mineGold = recipes.create({\n  name: 'Mining Gold',\n  produces: { 'Gold Ore': 1 },\n  consumes: { 'Gold Deposit': 10 },\n})\n\nconst smeltGold = recipes.create({\n  name: 'Smelt Gold',\n  produces: { 'Gold Bar': 1 },\n  consumes: { 'Gold Ore': 10 }\n})\n\nconst mintCoin = recipes.create({\n  name: 'Minting Gold Coins',\n  produces: { 'Gold Coin': 10 },\n  consumes: { 'Gold Bar': 1 },\n})\n\n// const digClay = recipes.create({\n//   name: 'Digging Clay',\n//   produces: { 'Clay Brick': 1 },\n//   consumes: { 'Clay Deposit': 1 },\n// })\n\n// const castPot = recipes.create({\n//   name: 'Casting Pottery',\n//   produces: { 'Fine Pottery': 1 },\n//   consumes: { 'Clay Brick': 1 },\n// })\n\n// const catchFish = recipes.create({\n//   name: 'Catching Fish',\n//   produces: { 'Caught Fish': 1 },\n//   consumes: { 'Swimming Fish': 1 },\n// })\n\n// const cookFish = recipes.create({\n//     name: 'Cooking Fish',\n//     produces: { 'Cooked Fish': 1 },\n//     consumes: { 'Caught Fish': 1 },\n// })\n\n//Set Jobs\njobs.set(miner, mineGold)\njobs.set(minter, mintCoin)\njobs.set(smelter, smeltGold)\n// jobs.set(claydigger, digClay)\n// jobs.set(artist, castPot)\n// jobs.set(fisherman, cookFish)\n// jobs.set(chef, cookFish)\n\nworld.evolve(({ resources, animals }, t) => {\n  // animals.add(1, 'Swimming Fish')\n\n  folks.work({ resources })\n\n  // employment\n  if (t % 10 === 0) {\n    const thePeople = [miner, minter, smelter]\n    thePeople.forEach(person => {\n      person.things.add(1, 'Gold Coin')\n      resources.remove(1, 'Gold Coin')\n    })\n  }\n\n  // taxation\n  // if (t % 1000 === 0) {\n  //   resources.remove()\n  // }\n\n  // wildlife hunting + fishing\n  if (t % 10 === 0) { // \n    // huntWildlife('Fish')\n    fisherman.things.add(1, 'Fish')\n    animals.remove(1, 'Fish')\n  }\n\n  // trade\n  const thePeople = [miner, minter, smelter]\n  // const theGoods = ['Fish', ]\n  thePeople.forEach(person => {\n    if (fisherman.things.count('Fish') > 3 && person.things.count('Gold Coin') > 5) {\n      give(fisherman, person, 5, 'Gold Coin')\n      give(person, fisherman, 1, 'Fish')\n    }\n  })\n})\n\n\nexport {world as Avernus}\n","import { Sequence } from \"../../collections\";\nimport { Person } from \"../../ecosphere/types\";\nimport { randomInteger } from \"../../ecosphere/utils/randomInteger\";\nimport { sample } from \"../../ecosphere/utils/sample\";\n\nexport class MonsterManual {\n  basicCreatures = {\n    // 'Null Index': { hp: 1, evasion: 95 },\n    'Dancing Light': { hp: 24, evasion: 1 },\n    'Crystalline Fog': { hp: 26, evasion: 1, reflect: 10 },\n    'Floating Light': { hp: 28, evasion: 1, speed: 1 },\n\n    'Mobile Wisp': { hp: 40, strength: 1, speed: 1, evasion: 1 },\n\n  };\n\n  challengingCreatures = {\n    Gremlin: { hp: 32, speed: 1, counter: 1, evasion: 1 },\n    Goblin: { hp: 40 },\n    Kobold: { hp: 50, strength: 1, speed: 2 },\n    Orc: { hp: 64, strength: 2, speed: 1, counter: 1 },\n  }\n\n  uncommonCreatures = {\n    Rat: { hp: 14, strength: 1, speed: 3, evasion: 1 },\n    Bat: { hp: 18, strength: 2, speed: 2, evasion: 1, },\n    Snake: { hp: 15, strength: 3, speed: 2, evasion: 2, },\n    Blob: { hp: 24, strength: 2, speed: 1, evasion: 1 },\n    Bear: { hp: 30, strength: 3, speed: 2, evasion: 1 },\n    Ghost: { hp: 70, 'magic damage': 1, evasion: 1, counter: 1, speed: 1, absorb: 1, defense: 1 },\n    Rogue: { hp: 74, strength: 2, speed: 1, 'bonus damage': 2, evasion: 2, counter: 2 },\n    Troll: { hp: 83, strength: 2, speed: 2, regen: 1, counter: 1 },\n    Giant: { hp: 95, strength: 2, speed: 2, defense: 1, absorb: 1 },\n  };\n\n  bosses = {\n    Priest: { hp: 57, heal: 4, 'holy damage': 6, defense: 6, 'holy defense': 3, evasion: 2 },\n    Vampire: { hp: 84, strength: 2, speed: 3, 'magic damage': 1, absorb: 2, evasion: 2 },\n    Drake: { hp: 100, strength: 3, speed: 2, regen: 2, 'magic damage': 2, evasion: 2 },\n    Lich: { hp: 140, strength: 4, speed: 6, defense: 6, 'magic damage': 6, evasion: 6 },\n  };\n\n  extraplanar = {\n    Demon: { hp: 166, strength: 3, speed: 6, counter: 6, evasion: 6 },\n    Angel: { hp: 199, evasion: 2, absorb: 2, regen: 2, counter: 9, defense: 9, 'magic defense': 2, 'holy damage': 9 },\n    Archdemon: { hp: 366, absorb: 6, strength: 6, speed: 6, defense: 6, evasion: 6, 'magic damage': 6, 'holy damage': 16 },\n    Dracolith: { hp: 247, strength: 7, 'magic damage': 7, speed: 7, defense: 7, evasion: 7, counter: 7 },\n    Archangel: { hp: 299, absorb: 9, strength: 9, speed: 9, defense: 9, evasion: 9, 'magic defense': 9, 'holy defense': 9, 'holy damage': 99 },\n\n    'Floating Sigil': { hp: 234, speed: 10, defense: 10, counter: 10 },\n    'Astral Filament': { hp: 1234, strength: 15, absorb: 10, evasion: 5, counter: 1, regen: 1 },\n    'Essence Sphere': { hp: 12345, 'magic damage': 12, 'holy damage': 12, 'bonus damage': 12 },\n  };\n\n  dragons = {\n    // ...and dragons :)\n    'Green Dragon': { hp: 900, strength: 5, speed: 8, defense: 4, 'magic damage': 16, evasion: 24 },\n    'Red Dragon': { hp: 1100, strength: 7, speed: 9, defense: 14, 'magic damage': 26, evasion: 34 },\n    'Blue Dragon': { hp: 2100, strength: 9, speed: 11, defense: 24, 'magic damage': 36, evasion: 44 },\n    'Golden Dragon': { hp: 2400, strength: 11, speed: 15, defense: 34, 'magic damage': 66, evasion: 55 },\n    'Black Dragon': { hp: 2900, strength: 11, speed: 15, defense: 34, 'magic damage': 66, evasion: 55 },\n    'Primordial Dragon': { hp: 3919, strength: 30, speed: 30, defense: 30, 'magic damage': 30, evasion: 30 },\n  };\n\n  rareCreatures = {\n    'Eldritch Lich': { hp: 2500, strength: 8, speed: 6, defense: 4, 'magic damage': 13, evasion: 5 },\n    'Primordial Vampire': { hp: 3800, strength: 3, speed: 10, defense: 10, 'holy defense': 10, 'magic defense': 10, 'magic damage': 3, evasion: 3, absorb: 4 },\n    Leviathan: { hp: 9999, strength: 10, speed: 10, defense: 25, evasion: 25, counter: 25 },\n    ...this.extraplanar,\n    ...this.dragons\n  };\n\n\n  bestiary: { [monster: string]: { [attr: string]: number; }; } = {\n    ...this.basicCreatures,\n    ...this.uncommonCreatures,\n    ...this.challengingCreatures,\n    ...this.rareCreatures,\n    ...this.bosses,\n  };\n\n  basicSubtypes = {\n    Hostile: { strength: 1 }, Intimidating: { strength: 2 },\n    Nimble: { speed: 1 }, Quick: { speed: 2 },\n    Timid: { evasion: 1 }, Spry: { evasion: 2 },\n    Vigilant: { regen: 1 }, Relentless: { regen: 2 },\n    Armored: { defense: 1 }, Hardened: { defense: 2 },\n    Benevolent: { heal: 1 }, Protective: { heal: 2 },\n    Snarling: { counter: 1 },\n\n    Emboldened: { 'bonus damage': 1 },\n  };\n\n  rareSubtypes: { [type: string]: { [attr: string]: number; }; } = {\n    Elusive: { evasion: 3 },\n    Voracious: { hp: 5, strength: 1, speed: 1 },\n    Vicious: { hp: 10, strength: 1, defense: 1 },\n    Vexatious: { hp: 15, counter: 1, evasion: 1 },\n\n    Arrogant: { hp: -5, evasion: 1, counter: 1, speed: 1 },\n\n    Adventurous: { hp: 10, 'bonus damage': 2 },\n    Questing: { hp: 20, 'bonus damage': 3 },\n\n    Silvered: { reflect: 1 }, Mirrored: { reflect: 2 },\n    Aggressive: { strength: 3 }, Dominating: { strength: 4 },\n    Swift: { speed: 3 }, Accelerated: { speed: 4 },\n    Reluctant: { evasion: 5 }, Hidden: { evasion: 10 }, Invisible: { evasion: 15 },\n    Resurrecting: { regen: 3 }, Regenerating: { regen: 4 },\n    Fortified: { defense: 3 },\n    Angelic: { heal: 3 },\n    Prismatic: { reflect: 3 },\n    // Hardened: { defense: 3, strength: 1, evasion: 1 },\n    Pugnacious: { 'bonus damage': 1, evasion: 1, counter: 1 },\n\n    // Elusive: { evasion: 1, defense: 1, regen: 1 },\n    Augmented: { strength: 1, 'magic damage': 1, 'bonus damage': 1 },\n    Skillful: { defense: 1, strength: 1, speed: 1, evasion: 1, counter: 1 },\n    Skeletal: { hp: -1, evasion: 2, absorb: 1, regen: 1 },\n    Undead: { hp: -1, strength: 1, regen: 1, absorb: 1, speed: 1, evasion: 1 },\n    Zombie: { hp: -2, evasion: 1, regen: 2, strength: 1 },\n    Favored: { hp: 1, strength: 2, speed: 2, 'magic damage': 1, regen: 1, evasion: 1 },\n    Fiendish: { hp: 2, strength: 3, speed: 3, defense: 1, regen: 1, evasion: 2 },\n    Fierce: { hp: 2, strength: 4, speed: 4, defense: 2, absorb: 2, evasion: 3, },\n    Opalescent: { hp: 2, reflect: 4, absorb: 2, evasion: 2, counter: 2, heal: 2 },\n    Cruel: { hp: 3, strength: 5, speed: 5, 'magic damage': 3, 'bonus damage': 2, absorb: 3, regen: 1, evasion: 4 },\n\n    Vortex: { hp: 1, reflect: 10, absorb: 10, evade: 50, counter: 50 },\n    Shadow: { hp: 2, 'magic damage': 20, absorb: 20, evade: 20, counter: 20 },\n    Luminous: { hp: 3, 'holy damage': 20, absorb: 20, evade: 20, counter: 20 },\n    Defiant: { hp: 1, 'bonus damage': 20, absorb: 20, evade: 20, counter: 20 },\n    Devious: { hp: 2, evasion: 2, counter: 20, absorb: 20 },\n    Draconic: { hp: 3, 'magic damage': 1, counter: 20, absorb: 20 },\n  };\n\n  subtypes: { [type: string]: { [attr: string]: number; }; } = {\n    Common: {},\n    Evasive: { evasion: 3, counter: 2 },\n    Retaliatory: { defense: 1, counter: 2 },\n    Inspired: { 'bonus damage': 1 },\n    Infused: { 'bonus damage': 2, 'magic damage': 1 },\n    Radiant: { 'holy damage': 1 },\n    Resplendent: { 'holy damage': 2, strength: 1, speed: 1 },\n    Heavy: { strength: 2, defense: 2 },\n    Titanic: { strength: 4, defense: 2 },\n    Unholy: { 'magic damage': 1, 'holy defense': 1 },\n    Blessed: { 'holy damage': 1, absorb: 1 },\n    Adept: { evasion: 1, counter: 1, defense: 1, strength: 1 },\n    ...this.basicSubtypes,\n    ...this.rareSubtypes,\n  };\n\n\n  perks: { [type: string]: { [attr: string]: number; }; } = {\n    Piercing: { hp: 15, strength: 1, defense: 1, evasion: 1, 'bonus damage': 1, },\n    Blessed: { hp: 15, absorb: 1, defense: 1, regen: 1, 'holy damage': 1, },\n    Enchanted: { hp: 15, defense: 1, evasion: 1 },\n    Clockwork: { hp: 15, defense: 1, speed: 2, evasion: 1 },\n    Phantasmal: { hp: 25, defense: 1, evasion: 4 },\n    Cosmic: { hp: 30, defense: 3, evasion: 3, strength: 3 },\n    Imperious: { hp: 40, defense: 4, 'magic damage': 3, speed: 3 },\n    // Obsidian: { hp: 15, defense: 1, speed: 2, evasion: 1 },\n    // Provocative: { hp: 50, defense: 5, evasion: 3, 'bonus damage': 4, 'magic damage': 3, speed: 3 },\n    // Challenging: { hp: 150, defense: 20, strength: 2, regen: 1, speed: 1, 'bonus damage': 5, evasion: 1 }\n  };\n  monsterIds = new Sequence();\n\n  difficulty = 1; // global multiplier on monster stats\n\n  generateBasicMonster(creature: Person) {\n    let base = sample(Object.keys(this.basicCreatures))\n    let type = 'Common'\n    creature.name = `${base} (${this.monsterIds.next})`;\n    // creature.things.add(5 + Math.floor(0.05 * cr * cr), 'hp')\n    const crFactor = 1\n    Object.entries(this.bestiary[base]).forEach(([thing, amount]) => creature.things.add(\n      Math.floor(amount * crFactor), thing));\n    Object.entries(this.subtypes[type]).forEach(([thing, amount]) => creature.things.add(\n      Math.floor(amount * crFactor), thing));\n  }\n\n  generate(creature: Person, cr: number = 1) {\n    if (cr <= 8) { this.generateBasicMonster(creature); return }\n    // console.log(\"generate monster with cr \" + cr);\n    // const simpleCreatures = ['Snake', 'Blob', 'Bat', 'Wisp']\n    let base = sample(Object.keys(this.challengingCreatures)) //cr <= 10 ? sample(Object.keys(this.basicCreatures)) : sample(Object.keys(this.challengingCreatures));\n\n\n    let type = randomInteger(0, 20) > 16 ? sample(Object.keys(this.basicSubtypes)) : 'Common';\n\n    // all subtypes..\n    if (cr >= 20 && randomInteger(0, 20) > 19) { type = sample(Object.keys(this.subtypes)); }\n\n    // all bases\n    if (cr >= 25 && randomInteger(0, 20) > 19) { base = sample(Object.keys(this.bestiary)); }\n\n    const name = type === 'Common' ? base : [type, base].join(' ');\n    creature.name = `${name} (${this.monsterIds.next})`;\n    const adjustedCr = 0.0015 * cr * cr;\n    // creature.things.add(1 + cr + Math.floor(100 * adjustedCr), 'hp')\n\n    const crFactor = this.difficulty + adjustedCr * 2;\n    Object.entries(this.bestiary[base]).forEach(([thing, amount]) => creature.things.add(\n      Math.floor(amount * crFactor), thing));\n    Object.entries(this.subtypes[type]).forEach(([thing, amount]) => creature.things.add(\n      Math.floor(amount * crFactor), thing));\n    creature.things.add(creature.things.count('hp'), 'max hp');\n    if (cr >= 15) {\n      creature.things.add(randomInteger(1, cr/2), 'defense');\n      creature.things.add(randomInteger(1, cr/2), 'strength');\n    }\n    if (cr >= 25) {\n      creature.things.add(randomInteger(1, cr/2), 'evasion');\n      creature.things.add(randomInteger(1, cr/2), 'counter');\n    }\n    if (cr >= 35) {\n      creature.things.add(randomInteger(1, cr/2), 'magic damage');\n      creature.things.add(randomInteger(1, cr/2), 'chain chance');\n    }\n    if (cr >= 45) {\n      creature.things.add(randomInteger(1, cr/2), 'holy damage');\n      creature.things.add(randomInteger(1, cr/2), 'reflect');\n    }\n  }\n\n  generateBoss(creature: Person, cr: number = 1) {\n    const base = sample(Object.keys(this.bosses));\n    const type = sample(Object.keys(this.rareSubtypes));\n    const perk = sample(Object.keys(this.perks));\n    const name = [perk, type, base].join(' ');\n    creature.name = name; // `${name} (${this.monsterIds.next})`\n    const crFactor = this.difficulty + 0.01 * cr;\n    Object.entries(this.bestiary[base]).forEach(([thing, amount]) => creature.things.add(\n      Math.floor(amount * crFactor), thing));\n    Object.entries(this.rareSubtypes[type]).forEach(([thing, amount]) => creature.things.add(\n      Math.floor(amount * crFactor), thing));\n    Object.entries(this.perks[perk]).forEach(([thing, amount]) => creature.things.add(\n      Math.floor(amount * crFactor), thing));\n    creature.things.add(creature.things.count('hp'), 'max hp');\n  }\n}\n","import { Person } from \"../../ecosphere/types\";\nimport { randomInteger } from \"../../ecosphere/utils/randomInteger\";\nimport { sample } from \"../../ecosphere/utils/sample\";\n\nexport class PlayerHandbook {\n  // okay, i guess give them the class as a perk... then each level up we can check + bump one of the class\n  // nice to have: sick multi-classing\n  static characterClasses: { [name: string]: { attributes: { [attr: string]: number; }; traits: string[]; }; } = {\n    Fighter: {\n      attributes: {\n        hp: 12,\n        strength: 1,\n        defense: 1,\n        speed: 0,\n        'bonus damage': 0,\n        'chain chance': 0,\n        'max chain': 0,\n      },\n      traits: ['Fitness', 'Combat Veteran']\n    },\n    // Knight: { attributes: { hp: 15, strength: 2, defense: 2, counter: 0, 'max chain': 0, 'chain chance': 0 }, traits: ['Medic'] },\n    // Mage: { attributes: { 'magic damage': 2, 'magic defense': 1, 'holy defense': 0 }, traits: ['Focus'] },\n    // Cleric: { attributes: { heal: 1, 'holy damage': 0, 'holy defense': 0 }, traits: ['Holy Symbol'] },\n    // Monk: { attributes: { hp: 5, 'reflect': 0, defense: 1, 'magic defense': 0, 'hp per step': 0 }, traits: ['Faith'] },\n    // Thief: { attributes: { hp: 10, speed: 1, evasion: 1, counter: 1, 'gold per kill': 0 }, traits: ['Swiftness'] },\n  };\n\n  static attributes: { [attrGroup: string]: string[]; } = {\n    // basic: [\n    // ],\n    common: [\n      'max hp',\n      // 'hp per victory',\n      // 'hp per day',\n      // 'hp per step',\n      // 'xp per kill',\n      // 'xp per li',\n      // 'xp per victory',\n      // 'xp per day', //'gold per li'\n      // 'gold per victory',\n      // 'xp per step',\n      // 'gold per day'\n      // 'gold per day',\n      // 'hp per day', // 'gold per day'\n      // 'max hp', 'xp per victory', 'hp per day', 'gold per day', 'xp per li', \n    ],\n    uncommon: [\n      // 'xp per victory',\n      // 'gold per victory',\n    ],\n    rare: [\n      // 'evasion',\n      // 'crit damage',\n      // 'xp per step',\n      // 'max chain', //'hp per step'\n    ],\n    epic: [\n      // 'xp per day', 'gold per step',\n      // 'xp per day', //'gold per li'\n      // 'counter',\n      // 'crit chance',\n    ],\n    legendary: [\n      // 'xp per kill',\n      // 'xp per li',\n      // 'xp per victory',\n      // 'counter',\n      // 'evasion',\n      // 'defense',\n      // 'strength',\n      // 'magic damage',\n      // 'holy damage',\n      // 'bonus damage',\n      // 'reflect',\n      // 'heal',\n      // 'damage to all',\n      // 'chain chance',\n    ],\n  };\n\n  // some perks benefits the effective value of a stat by adding % bonus per rank\n  static perkBenefits: { [perk: string]: { [attr: string]: number; }; } = {\n    'Cloaking Robe of Elvenkind': { 'magic damage': 0.05, 'magic defense': 0.5, evasion: 0.25, 'holy defense': 0.05 },\n    'Combat Veteran': { strength: 0.05, defense: 0.05, counter: 0.05, evasion: 0.05, 'crit damage': 0.05, 'bonus damage': 0.05, },\n    'Fine Raiment': { 'magic damage': 0.1, 'magic defense': 0.2, defense: 0.15, evasion: 0.1 },\n    'Holy Symbol': { 'holy damage': 0.5, 'holy defense': 0.15, heal: 0.1, regen: 0.1 },\n    'Royal Armorer': { defense: 0.5, 'holy defense': 0.25, 'magic defense': 0.25, evasion: 0.25 },\n    // Barbarian: { 'bonus damage': 0.5, 'crit damage': 0.05, strength: 0.15, 'chain chance': 0.1, 'max chain': 0.1 },\n    Brutality: { strength: 0.5, speed: 0.25, 'bonus damage': 0.25, 'max chain': 0.1 },\n    Counterweight: { counter: 0.5, evasion: 0.1, 'crit damage': 0.05, 'max chain': 0.1 },\n    Efferverscence: { regen: 0.25, counter: 0.25, 'crit damage': 0.25, 'holy defense': 0.25, 'max chain': 0.25 },\n    Efficacious: { counter: 0.1, evasion: 0.1, 'bonus damage': 0.1, strength: 0.1, defense: 0.1, 'magic defense': 0.1, heal: 0.1 },\n    Opalescence: { reflect: 0.2, absorb: 0.2, evasion: 0.2, defense: 0.2, regen: 0.2, heal: 0.2 },\n    Ethereal: { 'magic damage': 0.25, 'magic defense': 0.25, evasion: 0.5, defense: 0.25 },\n    Faith: { 'holy damage': 0.25, 'holy defense': 0.5, heal: 0.25, regen: 0.1 },\n    Finesse: { 'crit chance': 0.25, 'crit damage': 0.15, 'max chain': 0.05, 'chain chance': 0.1 },\n    Fitness: { strength: 0.1, defense: 0.1, speed: 0.1, evasion: 0.1, counter: 0.1, regen: 0.1 },\n    Fluidity: { 'crit chance': 0.1, 'crit damage': 0.1, evasion: 0.1, counter: 0.1, speed: 0.1 },\n    Dexterity: { defense: 0.25, 'magic defense': 0.1, speed: 0.1, evasion: 0.1, 'chain chance': 0.1 },\n    Precision: { speed: 0.1, 'crit damage': 0.25, evasion: 0.05, 'max chain': 0.1 },\n    Swiftness: { speed: 0.2, counter: 0.15, 'crit chance': 0.15, defense: 0.1 },\n    Rapidity: { speed: 0.5, counter: 0.1, 'crit damage': 0.25, evasion: 0.1 },\n    Medic: { heal: 0.5, regen: 0.1, absorb: 0.1, defense: 0.1 },\n    Vitality: { strength: 0.1, speed: 0.25, regen: 0.5, heal: 0.1 },\n    Whirlwind: { 'chain chance': 0.5, 'max chain': 0.5, 'damage to all': 0.5, 'bonus damage': 0.1 },\n    Focus: { 'magic damage': 0.5, 'magic defense': 0.25, 'holy damage': 0.1, 'holy defense': 0.5 },\n    Iridescence: { 'magic damage': 0.5, 'holy damage': 0.5, 'bonus damage': 0.5, 'damage to all': 0.5 },\n    Concentration: { 'magic defense': 0.25, 'holy defense': 0.5, defense: 0.1, evasion: 0.1, counter: 0.1 },\n    Salvation: { 'holy damage': 0.5, 'holy defense': 0.2, defense: 0.1, reflect: 0.1, absorb: 0.1 },\n  };\n\n  static perks: { [perkGroup: string]: string[]; } = {\n    common: [\n      'Fitness',\n      'Finesse',\n      'Rapidity',\n      'Precision',\n      'Medic',\n      'Focus', // +10% to magic dmg per rank\n    ],\n    uncommon: [\n      'Concentration',\n      'Swiftness',\n      'Fluidity',\n      'Faith',\n      'Combat Veteran',\n      'Efficacious', // small bonuses to many skills\n    ],\n    rare: [\n      'Dexterity',\n      // 'Barbarian',\n      'Brutality',\n      'Ethereal',\n      'Perspicuous',\n      'Vitality', // boost to regen\n    ],\n    epic: [\n      'Iridescence',\n      'Fine Raiment',\n      'Royal Armorer',\n      'Whirlwind', // bonus % to chain chance + damage to all\n    ],\n    legendary: [\n      'Salvation',\n      'Eternal Victory',\n      'Perfectionist',\n      'Effervescence', // decent bonuses to many skills\n      'Opalescence',\n    ]\n  };\n\n  static generate(hero: Person, characterClass: string) {\n    const baseStartingHp = 42;\n    hero.traits.add(1, characterClass)\n    hero.things.add(baseStartingHp, 'hp')\n    // hero.things.add(1, 'strength')\n    // hero.things.add(1, 'speed')\n    // hero.things.add(randomInteger(1,4), 'evasion')\n    // hero.things.add(randomInteger(1,4), 'counter')\n    const template = this.characterClasses[characterClass];\n    Object.keys(template.attributes).forEach(attr => {\n      const amount = template.attributes[attr]\n      hero.things.add(amount, attr)\n    });\n    (template.traits).forEach(trait => hero.traits.add(1, trait))\n    hero.things.add(2000, 'xp per li')\n    // hero.things.add(5, 'xp per kill')\n    // hero.things.add(1, 'gold per day')\n    hero.things.add(Math.floor(baseStartingHp * 0.75), 'hp per victory')\n    hero.things.add(Math.floor(baseStartingHp * 1.2), 'max hp')\n    hero.traits.add(3, 'Potion of Life')\n    hero.things.add(1, 'level')\n    for (let i=0; i<10; i++) {\n      this.levelUp(hero)\n    }\n  }\n\n  static levelUp(pc: Person) {\n    const attributeBoosts: { [key: string]: number; } = {\n      // basic: 13,\n      common: 8, // randomInteger(3, 5),\n      uncommon: 5, //randomInteger(2, 3),\n      rare: 3, //randomInteger(1, 2),\n      epic: 2, //randomInteger(0, 1),\n      legendary: 1 //randomInteger(0, 1),\n    };\n\n    Object.keys(this.attributes).forEach(rarity => {\n      for (let i = 0; i < attributeBoosts[rarity]; i++) {\n        const levelAttr = sample(this.attributes[rarity]);\n        if (levelAttr) {\n        const amount = 1; //randomInteger(1,2)\n          pc.things.add(amount, levelAttr);\n          console.log(`${levelAttr} improves by ${amount}`);\n        }\n      }\n    });\n\n    const perkLevels: { [key: string]: number; } = {\n      common: 2,\n      uncommon: 3,\n      rare: 5,\n      epic: 8,\n      legendary: 13,\n    };\n\n    Object.keys(this.perks).forEach(rarity => {\n      if (pc.things.count('level') % perkLevels[rarity] === 0) {\n        const perk = sample(this.perks[rarity]);\n        if (perk) {\n          console.log(`Gain a rank in ${perk} (${rarity})`);\n          pc.traits.add(1, perk);\n        }\n      }\n    });\n\n    // const classBonuses = PlayerHandbook.characterClasses\n    // okay, for each triat\n    if (pc.things.count('level') % 3 === 0) {\n      pc.traits.list().forEach((trait) => {\n        // console.log(trait)\n        if (Object.keys(this.characterClasses).includes(trait.name)) {\n        //   // it's a pc class\n          Object.entries(this.characterClasses[trait.name].attributes).forEach(([attr, value]) => {\n            // if (value === 0) { if (randomInteger(0,12) < 2) return }\n            const amount = value > 0 ? randomInteger(1, Math.max(1,value)) : 1\n            console.log(`${attr} improves by ${amount} (${trait.name})`);\n            pc.things.add(amount, attr)\n          })\n        }\n      })\n      // trait\n    }\n  }\n}\n","import { boundMethod } from \"autobind-decorator\"\nimport { List, Sequence } from \"../../collections\"\nimport { Community } from \"../../ecosphere/Community\"\nimport Model from \"../../ecosphere/Model\"\nimport { EvolvingStocks, ManageStocks, Person } from \"../../ecosphere/types\"\nimport { randomInteger } from \"../../ecosphere/utils/randomInteger\"\nimport { sample } from \"../../ecosphere/utils/sample\"\nimport { where } from \"../../ecosphere/utils/where\"\nimport { MonsterManual } from \"./MonsterManual\"\nimport { PlayerHandbook } from \"./PlayerHandbook\"\n\n// try to keep magic numbers here?\nclass DungeonMasterGuide {\n  static durations = { round: 74, day: 6800 }\n}\n\n// type SimpleEvent = { at: number }\ntype EventCommon = { id: number, at: number }\ntype EnemyInjured = EventCommon & { kind: 'enemy-injured', enemyName: string, amount: number }\ntype TurnStarted = EventCommon & { kind: 'turn-started' }\ntype Event = EnemyInjured | TurnStarted\nclass Arena extends Model {\n  events = new List<Event>()\n  // emit(event: Event, title?: string, message?: string) {\n    // if (title) { console.log(title) } //\"EVENT\", event)\n  eventIds = new Sequence()\n  enemyInjured(name: string, amount: number) {\n    this.events.add({\n      id: this.eventIds.next,\n      kind: 'enemy-injured',\n      enemyName: name,\n      amount,\n      at: this.ticks\n    })\n      // : `${name} took ${amount} damage`, description: message, kind: event.kind, at: this.ticks })\n  }\n\n  turnStarted() {\n    this.events.add({ id: this.eventIds.next, kind: 'turn-started', at: this.ticks })\n  }\n\n  constructor() {\n    super('The Arena')\n    const globals = [ 'day', 'step', 'li', 'gil', 'kill', 'victory', 'death', 'tpk' ]\n    globals.forEach(resource => this.resources.create(resource))\n    this.people.create('Adventurers')\n    this.spawnHero('Fighter')\n    // this.spawnHero('Cleric')\n    // this.spawnHero(sample(['Monk', 'Mage'])) \n    // this.spawnHero(sample(Object.keys(PlayerHandbook.characterClasses)))\n    Object.keys(PlayerHandbook.characterClasses).forEach(characterClass => {\n      this.actions.create({ name: `Hire ${characterClass}`, act: () => this.spawnHero(characterClass) })\n    })\n    this.actions.create({ name: `Hire Party`, act: () => {\n      for (let i=0; i<3; i++) {\n        this.spawnHero(sample(Object.keys(PlayerHandbook.characterClasses))) \n      }\n      // this.spawnHero(sample(Object.keys(PlayerHandbook.characterClasses))) \n      // this.spawnHero(sample(Object.keys(PlayerHandbook.characterClasses))) \n    }})\n    this.people.create('Enemies')\n    // enemies.obscured = true // only show names? really want hp -- more granular/whitelist?\n    this.spawnEnemyParty()\n    this.evolve(this.tick)\n  }\n\n  metrics = {\n    'challenge rating': () => this.challengeRating,\n    // 'damage per tick': () => this.damagePerTick,\n    // turns: () => this.recent('turn-started').length,\n  }\n\n  heroIds = new Sequence()\n  @boundMethod\n  spawnHero(characterClass: string) {\n    const name = `${characterClass} (${this.heroIds.next})`;\n    const hero = this.party.create(name)\n    PlayerHandbook.generate(hero, characterClass)\n  }\n\n  get challengeRating() {\n    if (this.party.count === 0) return -1;\n    const totalLevels = this.party.list().map(adv => adv.things.count('level')).reduce((a, b) => a + b)\n    const cr = 1 \n      + (this.resources.count('step')/1250)\n      + (this.resources.count('day')/14)\n      + (this.party.count) \n      + (totalLevels / this.party.count);\n    return Math.floor(cr);\n  }\n\n  private recent(kind: string): Event[] { return this.recentEvents.filter(where('kind', kind)) }\n\n  metricGrain = 150 //DungeonMasterGuide.durations.round\n  get damagePerTick() {\n    const enemyInjuries: EnemyInjured[] = this.recent('enemy-injured') as EnemyInjured[]\n    // const turns = 1 + this.recent('turn-started').length //this.recentEvents.filter(where('kind', 'turn-started')).length\n    const totalInjuryAmount = enemyInjuries.map((injury: EnemyInjured) => injury.amount).reduce((a, b) => a + b, 0)\n    return (Math.floor(\n      totalInjuryAmount / this.metricGrain //Math.floor(totalInjuryAmount / this.metricGrain)\n    ))\n  }\n\n  get recentEvents() {\n    return this.events.items.filter(e => e.at > this.ticks-this.metricGrain)\n  }\n\n  manual = new MonsterManual()\n\n  @boundMethod\n  spawnEnemyParty() {\n    if (this.party.count === 0) return;\n\n    for (let i = 0; i < randomInteger(1,2+this.party.count); i++) {\n      const enemy = this.enemies.create('new enemy')\n      this.manual.generate(enemy, this.challengeRating)\n    }\n\n    // if (randomInteger(0,12) > 11) {\n    //   const enemy = this.enemies.create('new big enemy')\n    //   this.manual.generateBoss(enemy, this.challengeRating)\n    // }\n  }\n\n  get party() { return this.people.lookup('Adventurers') }\n  get enemies() { return this.people.lookup('Enemies') }\n\n  private injure(defender: Person, amount: number, aggressor: Person, reflected: boolean = false) {\n    const damage = Math.floor( Math.min(defender.things.count('hp'), amount) )\n    if (damage <= 0) return;\n\n    defender.things.remove(damage, 'hp')\n    if (this.enemies.list().includes(defender)) {\n      this.enemyInjured(defender.name, damage)\n    }\n\n    console.log(`${aggressor.name} hit ${defender.name} for ${damage}!`)\n    const absorb = Math.min(this.effective(aggressor, 'absorb'), damage)\n    if (absorb > 0) {\n      const absorption = randomInteger(0,absorb) \n      console.log(`${aggressor.name} absorbed ${absorption} hp!`)\n      this.heal(aggressor, absorption)\n    }\n    if (defender.things.count('hp') > 0) {\n      const reflect = Math.min(this.effective(defender, 'reflect'), damage)\n      if (reflect > 0 && !reflected) {\n        console.log(`${defender.name} reflected ${reflect} damage!`)\n        this.injure(aggressor, reflect, defender, true)\n      }\n      const counter = this.effective(defender, 'counter')\n      if (randomInteger(0,100) < counter) {\n        console.log(`${defender.name} counter-attacked against ${aggressor.name}!`)\n        this.strike(defender, aggressor)\n      }\n    }\n  }\n\n  private effective(person: Person, attribute: string) {\n    const base = person.things.count(attribute)\n    if (base === 0) return 0;\n    let multiplier = 1;\n    Object.keys(PlayerHandbook.perkBenefits).forEach(perk => {\n      const benefits = PlayerHandbook.perkBenefits[perk]\n      const benefitAttrs = Object.keys(benefits)\n      if (benefitAttrs.includes(attribute)) {\n        const ranks = person.traits.count(perk)\n        if (ranks > 0) {\n          const benefit = benefits[attribute] * ranks\n          multiplier += benefit\n        }\n      }\n    })\n    const value = Math.floor(base * multiplier);\n    return value\n  }\n\n  private strike(aggressor: Person, defender: Person) {\n    const holyDefense = this.effective(defender, 'holy defense')\n    const holyDamage = Math.max(0, this.effective(aggressor, 'holy damage') - holyDefense)\n    const magicDefense = this.effective(defender, 'magic defense')\n    const magicDamage = Math.max(0, this.effective(aggressor, 'magic damage') - magicDefense)\n    let physicalDamage = 0;\n    let criticalStrike = false;\n    const evade = 1 + this.effective(defender, 'evasion')\n    const hitRoll = randomInteger(0,100)\n    const hit = hitRoll > Math.min(95, evade * 2)\n    if (hit) {\n      const defense = this.effective(defender, 'defense')\n      const baseDamage = Math.max(1,this.effective(aggressor, 'strength') - defense)\n      const bonus = this.effective(aggressor, 'bonus damage')\n      const critChance = 1 + this.effective(aggressor, 'crit chance')\n      criticalStrike = randomInteger(0,100) < Math.max(50, critChance * 2)\n      if (criticalStrike) {\n        console.log(`${aggressor.name} landed a critical strike on ${defender.name}!`)\n      }\n      physicalDamage = criticalStrike \n        ? baseDamage + bonus + randomInteger(1, this.effective(aggressor, 'crit damage'))\n        : randomInteger(1, baseDamage) + bonus\n    }\n    const overallDamage = magicDamage + physicalDamage + holyDamage\n    if (overallDamage > 0) {\n      this.injure(defender, overallDamage, aggressor)\n    } else {\n      console.log(`${aggressor.name} swung for ${defender.name} but missed!`)\n    }\n  }\n\n  attack(aggressors: Community, defenders: Community) {\n    aggressors.list().forEach(aggressor => {\n      const baseSpeed = 12;\n      const aggSpeed = Math.min(baseSpeed, aggressor.things.count('speed'))\n      const speed = 1+Math.floor(Math.max(baseSpeed - aggSpeed, 0))\n      if (this.ticks % speed === 0) {\n        const damageAll = this.effective(aggressor, 'damage to all')\n        if (damageAll > 0) {\n          defenders.list().forEach(defender => {\n            const damage = randomInteger(1, damageAll)\n            this.injure(defender, damage, aggressor)\n          })\n        }\n\n        // normal attack\n        const defender = sample(defenders.list()) // todo attack-weakest policy..\n        if (defender) {\n          let done = false;\n          const hit = () => this.strike(aggressor, defender)\n\n          hit()\n          const chainChance = this.effective(aggressor, 'chain chance')\n          const maxChain = 1 + this.effective(aggressor, 'max chain')\n          let chain = 0\n          while (!done && chain++ < maxChain) {\n            let chainRoll = randomInteger(0,100)\n            if (chainRoll < chainChance) {\n              console.log(`...and swung again (${chain} times)!`)\n              hit()\n            }\n          }\n        }\n      }\n    })\n  }\n\n  heal(healee: Person, amount: number) {\n    const hp = healee.things.count('hp')\n    const maxHp = healee.things.count('max hp')\n    const maxHeal = maxHp - hp\n    const heal = Math.min(maxHeal, amount)\n    healee.things.add(Math.floor(heal), 'hp')\n  }\n\n  per(unit: string) {\n    this.party.list().forEach(adventurer => {\n      const xp = this.effective(adventurer, `xp per ${unit}`)\n                * (1 + 0.1 * adventurer.traits.count('Perspicuous'))\n                * (1 + 0.25 * adventurer.traits.count('Perfectionist'))\n      adventurer.things.add(Math.floor(xp), 'xp')\n\n      const gil = this.effective(adventurer, `gold per ${unit}`)\n                * (1 + 0.25 * adventurer.traits.count('Perfectionist'))\n      this.resources.add(Math.floor(gil), 'gil')\n\n      if (adventurer.things.count('hp') < adventurer.things.count('max hp')) {\n        const hp = this.effective(adventurer, `hp per ${unit}`)\n                * (1 + 0.25 * adventurer.traits.count('Perfectionist'))\n        this.heal(adventurer, hp)\n      }\n    })\n  }\n\n  private round() {\n    this.per('round')\n    this.party.list().forEach(adventurer => {\n      const regen = this.effective(adventurer, 'regen')\n      this.heal(adventurer, regen)\n      if (adventurer.things.count('heal')) {\n        this.party.list().forEach(healee => {\n            const health = this.effective(adventurer, 'heal')\n            this.heal(healee, randomInteger(1,health))\n        })\n      }\n\n      if (adventurer.traits.count('Potion of Life') > 0 &&\n          adventurer.things.count('hp') < 0.5 * adventurer.things.count('max hp')) {\n        console.log(`${adventurer.name} drank a potion of life!`)\n        adventurer.traits.remove(1, 'Potion of Life')\n        const health = 20 + randomInteger(0, 10) + this.effective(adventurer, 'heal')\n        this.heal(adventurer, health)\n      }\n    })\n\n    this.enemies.list().forEach(enemy => {\n      this.heal(enemy, this.effective(enemy, 'regen'))\n    })\n  }\n\n  @boundMethod\n  tick({ resources }: EvolvingStocks, t: number) {\n    this.party.list().forEach(adventurer => {\n      const level = adventurer.things.count('level')\n      const levelCost = Math.floor(Math.pow(2, 5+level))\n      if (adventurer.things.count('xp') > levelCost) {\n        adventurer.things.remove(levelCost, 'xp')\n        adventurer.things.add(1, 'level')\n        console.log(`${adventurer.name} level up!`)\n        PlayerHandbook.levelUp(adventurer)\n      }\n    })\n\n    if (t % DungeonMasterGuide.durations.round === 0) {\n      this.round()\n    }\n\n    if (t % DungeonMasterGuide.durations.day === 0) {\n      resources.add(1, 'day')\n      this.per('day')\n    }\n\n    if (this.enemies.count === 0 && this.party.count > 0) {\n      if (t % 5 === 0) {\n        this.resources.add(1, 'step')\n        this.per('step')\n        if (this.resources.count('step') % 500 === 0) {\n          resources.add(1, 'li')\n          this.per('li')\n          // store..\n          const items = [\n            'Potion of Life', // heals ~25 at 50% hp\n            'Healing Salve',\n          ]\n          const rareItems = [\n            'Shell Matrix', // functionally -- resurrect charges (w/ limitations)\n            'Cloaking Robe of Elvenkind', // large % bonus to evade\n            'Counterweight' // large % bonus to counter chance\n          ]\n          const stock = randomInteger(0,20) > 19 ? rareItems : items\n          while (this.resources.count('gil') > 1000) {\n            // give items to leader\n            let recipient = sample(this.party.list()) //[0]\n            recipient.traits.add(1, sample(stock))\n            this.resources.remove(1000, 'gil')\n          }\n        }\n\n        const encounterChance = 60 + this.resources.count('li') + this.party.count\n        const randomEncounter = randomInteger(0,100) > encounterChance\n        if (randomEncounter) { //randomInteger(0,100) > 86) {\n          this.spawnEnemyParty()\n          this.per('encounter')\n        }\n      }\n\n       \n    } else {\n      this.turnStarted()\n      this.per('turn')\n      this.attack(this.party, this.enemies)\n      this.attack(this.enemies, this.party)\n      this.mortalityCheck(resources)\n    }\n  }\n\n  private mortalityCheck(resources: ManageStocks) {\n    this.party.list().forEach(adventurer => {\n      if (adventurer.things.count('hp') <= 0) {\n        if (adventurer.traits.count('Eternal Victory') > 0) {\n          this.heal(adventurer, 200)\n          adventurer.traits.remove(1, 'Eternal Victory')\n        } else if (adventurer.traits.count('Healing Salve') > 0) {\n          this.heal(adventurer, 100)\n          adventurer.traits.remove(1, 'Healing Salve')\n        } else if (adventurer.traits.count('Shell Matrix') > 0) {\n          this.heal(adventurer, 50)\n          adventurer.things.add(150, 'magic hp')\n          adventurer.traits.remove(1, 'Shell Matrix')\n        } else {\n          this.per('death')\n          this.party.destroy(adventurer.name)\n          resources.add(1, 'death')\n          console.log(`${adventurer.name} was slain!`)\n          if (this.party.count === 0) {\n            this.per('tpk')\n            resources.add(1, 'tpk')\n            console.log(\"The party has fallen... The quest is lost.\")\n          }\n        }\n      }\n    })\n\n    this.enemies.list().forEach(enemy => {\n      if (enemy.things.count('hp') <= 0) {\n        this.per('kill')\n        this.enemies.destroy(enemy.name)\n        resources.add(1, 'kill')\n        console.log(`${enemy.name} was slain!`)\n        if (this.enemies.count === 0) {\n          this.per(\"victory\")\n          resources.add(1, 'victory')\n          console.log(\"The party was victorious! The quest continues...\")\n          return\n        }\n      }\n    })\n  }\n}\n\nconst arena = new Arena()\nexport default arena\n","// todo: gen a new society with moieties; gen new individuals; work!\n\nimport { boundMethod } from \"autobind-decorator\";\nimport Model from \"../ecosphere/Model\"\nimport { EvolvingStocks } from \"../ecosphere/types\";\nimport { randomInteger } from \"../ecosphere/utils/randomInteger\";\nimport { sample } from \"../ecosphere/utils/sample\";\n\n// long-term: assemble a bunch of different societies + see how different policies/designs work\nexport class Society extends Model {\n  resourceNames: string[] = [ 'Wheat', 'Bread', 'Wine', 'Water', 'Clay', 'Coal' ]\n  animalNames: string[] = [ 'Sheep', 'Cow' ] //, 'Pig', 'Chicken' ] // Elk', 'Sheep', 'Wolf', 'Rabbit', 'Deer', 'Heron', 'Ibis', 'Lion', 'Moose', 'Raccoon', 'Hawk', 'Bluebird', 'Owl', 'Mouse', 'Fox', 'Robin', 'Dove', 'Elephant' ]\n  treeNames: string[] = [ 'Pine', 'Spruce' ] //, 'Juniper', 'Elm' ] //, 'Alder', 'Elm', 'Aspen', 'Oak', 'Beech', 'Pear', 'Cherry' ]\n  fruitTreeNames: string[] = [ 'Pear', 'Cherry' ] //, 'Apple', 'Peach' ] //, 'Alder', 'Elm', 'Aspen', 'Oak', 'Beech', 'Pear', 'Cherry' ]\n  plantNames: string[] = [ 'Grape', 'Blueberry' ] //, 'Strawberry', 'Goji' ]\n  strataNames: string[] = [ 'Nobility', 'Merchants', 'Workers', 'Farmers' ]\n\n  meatNames: { [name: string]: string } = { 'Cow': 'Beef', 'Chicken': 'Poultry', 'Pig': 'Pork', 'Sheep': 'Mutton'  }\n\n  constructor() { super('A Society'); this.setup() }\n  setup() {\n    this.strataNames.forEach(strata => {\n      const socialClass = this.people.create(strata)\n      socialClass.birth()\n      socialClass.birth()\n      socialClass.birth()\n    })\n    this.resourceNames.forEach(resource => this.resources.create(resource))\n    this.animalNames.forEach(animal => {\n      const creature = this.animals.create(animal)\n      creature.birth()\n      this.resources.create(this.meatNames[animal])\n    })\n    this.treeNames.forEach(tree => {\n      this.resources.create(`${tree} Wood`)\n      this.resources.create(`${tree} Tree`)\n      this.resources.create(`${tree} Seed`)\n    })\n    this.fruitTreeNames.forEach(fruitTree => {\n      this.resources.create(`${fruitTree} Wood`)\n      this.resources.create(`${fruitTree} Tree`)\n      this.resources.create(`${fruitTree} Seed`)\n      this.resources.create(`${fruitTree}`) // fruit\n    })\n    this.plantNames.forEach(plant => {\n      this.resources.create(`${plant} Plant`)\n      this.resources.create(`${plant} Seed`)\n      this.resources.create(`${plant}`)\n    })\n    this.evolve(this.evolution)\n  }\n\n  @boundMethod\n  evolution({ resources, animals }: EvolvingStocks, t: number) {\n    this.animalNames.forEach(animalName => {\n      if (randomInteger(0,20) > 18) {\n        animals.add(1, animalName)\n        // animals.lookup(animal).birth()\n      }\n    })\n\n    // ..\n    this.people.lookup('Workers').list().forEach(worker => {\n      \n\n      // if (randomInteger(0,12) > 10) {\n      const randomTree = (sample(this.treeNames))\n      if (resources.count(`${randomTree} Tree`) > 0) {\n        resources.add(randomInteger(2, 3), `${randomTree} Wood`)\n        resources.add(randomInteger(0, 1), `${randomTree} Seed`)\n        resources.remove(1, `${randomTree} Tree`)\n      }\n      // }\n      // pay to keep wildlife in line??\n      // person.currency += 1\n\n      // todo expose a status..?\n      // person.name = 'Hunt ' + randomAnimal.name\n    })\n\n    this.people.lookup('Farmers').list().forEach(farmer => {\n      // if (randomInteger(0,12) > 10) {\n        const randomAnimal = (sample(this.animalNames))\n        animals.remove(1, randomAnimal)\n        resources.add(1, this.meatNames[randomAnimal])\n      // }\n\n      const randomPlant = sample(this.plantNames)\n      if (resources.count(`${randomPlant} Plant`) > 0) {\n        resources.remove(1, `${randomPlant} Plant`)\n        resources.add(1, randomPlant)\n      } else {\n        resources.add(1, `${randomPlant} Plant`)\n        resources.remove(1, `${randomPlant} Seed`)\n      }\n    })\n  }\n}\n","import { boundMethod } from 'autobind-decorator'\nimport { List, Sequence } from '../collections'\nimport { Collection } from '../ecosphere/Collection';\nimport Model from '../ecosphere/Model'\nimport { ManageStocks, Person, Recipe, TimeEvolution } from '../ecosphere/types'\nimport { randomInteger } from '../ecosphere/utils/randomInteger';\nimport { unique } from '../ecosphere/utils/unique';\nimport { where } from '../ecosphere/utils/where';\n\ntype Currency = number\ntype Order = { [itemName: string]: number }\ntype Bill = { id: number, order: Order, price: Currency, account: Receivable }\ninterface Receivable {\n  receive(items: any[], bill: Bill): Currency\n}\n\ntype EventKind = 'order:fulfilled'\ntype Event = { id: number, name: string, description: string, at: number, kind: EventKind }\nexport class Factory extends Model {\n  events = new Collection<Event>()\n  emit(event: EventKind, title?: string, message?: string) {\n    // if (title) { console.log(title) } //\"EVENT\", event)\n    this.events.create({ name: title, description: message, kind: event, at: this.ticks })\n  }\n  private bills = new List<Bill>()\n\n  metrics = {\n    'Production Speed': () => this.deliveryRate,\n    'Total Fulfillments': () => this.fulfillmentEvents.length,\n    'Orders In Queue': () => this.bills.count\n  }\n\n  metricGrain = 100\n  get deliveryRate() {\n    return this.recentEvents.filter(where('kind', 'order:fulfilled')).length / this.metricGrain\n  }\n\n  get recentEvents() {\n    return this.events.list().filter(e => e.at > this.ticks-this.metricGrain)\n  }\n\n  get fulfillmentEvents() {\n    return this.events.list().filter(where('kind', 'order:fulfilled'))\n  }\n\n  constructor(\n    name: string,\n  ) {\n    super(`${name} Factory`)\n  }\n\n  product(name: string, consumes: { [resourceName: string]: number }) {\n    this.actions.create({ name: `Order ${name}`, act: ({ count, deliverTo }: { count: number, deliverTo: Receivable }) => {\n      this.order(count || 20, name, deliverTo || { receive: () => {\n        return 1;\n      }})\n    }})\n\n    this.resources.create(name)\n    this.workers.recipes.create({ name, produces: { [name]: 1 }, consumes });\n  }\n\n  @boundMethod\n  reboot() {\n    this.reset()\n    this.people.create('Workers')\n    this.bills.clear()\n    this.evolve(this.evolution)\n    this.policies.create({ name: 'FIFO', manage: () => {\n        const firstUnfulfilled = this.unfulfilled(this.bills.first)[0]\n        const produceUnfulfilled = this.workers.recipes.lookup(firstUnfulfilled)\n        if (produceUnfulfilled) {\n          this.workers.list().forEach(worker => this.produce(worker, produceUnfulfilled))\n        }\n    }})\n    this.policies.create({ name: 'Round Robin', manage: () => {\n        const allBillsRequested = unique(this.bills.items.flatMap(bill => {\n          return this.unfulfilled(bill)\n        }))\n        this.workers.list().forEach((worker, i) => {\n          const nextUnfulfilled = allBillsRequested[(i % (allBillsRequested.length))]\n          const produceUnfulfilled = this.workers.recipes.lookup(nextUnfulfilled)\n          if (produceUnfulfilled) {\n            this.produce(worker, produceUnfulfilled)\n          }\n        })\n    }})\n\n    this.choose('FIFO')\n  }\n\n  unfulfilled(bill?: Bill) {\n    if (bill === undefined) { return [] }\n    let orderItemNames = Object.keys(bill.order)\n    let unfulfilled: string[] = []\n    orderItemNames.forEach(item => {\n      let order = bill.order[item]\n      let amount = this.resources.count(item)\n      if (amount < order) {\n        unfulfilled.push(item)\n      }\n    })\n    // console.log(\"Unfulfilled from bill: \" + inspect(bill.order))\n    return unfulfilled\n  }\n\n  produce = (worker: Person, recipe: Recipe) => {\n    if (this.canProduce(recipe)) {\n      this.workers.jobs.set(worker, recipe)\n    } else {\n      if (recipe.consumes) {\n        const required: string[] = []\n        Object.entries(recipe.consumes).forEach(([resource, amount]) => {\n          // do we have enough of the resource?\n          if (this.resources.count(resource) < amount) {\n            required.push(resource)\n          }\n        })\n\n        let requirement = required[randomInteger(0,required.length)]; // could sample here..\n        // need to find a recipe that produces requirement\n        let producingRequirement: Recipe | null =  null\n        this.workers.recipes.each(recipe => {\n          if (recipe.produces[requirement]) {\n            producingRequirement = recipe\n          }\n        })\n        if (producingRequirement) {\n        //  this.workers.jobs.set(worker, producingRequirement)\n          this.produce(worker, producingRequirement)\n        }\n      }\n    }\n  }\n\n  missingRequirements = (recipe: Recipe) => {\n    const missing: string[] = []\n    if (recipe.consumes) {\n      Object.entries(recipe.consumes).forEach(([resource, amount]) => {\n        if (this.resources.count(resource) < amount) {\n          missing.push(resource)\n        }\n      })\n    }\n    return missing\n  }\n\n  canProduce = (recipe: Recipe) => {\n    let mayProduce = true\n    if (recipe.consumes) {\n      Object.entries(recipe.consumes).forEach(([resource, amount]) => {\n        if (this.resources.count(resource) < amount) {\n          mayProduce = false\n        }\n      })\n    }\n    return mayProduce\n  }\n\n  evolution: TimeEvolution = ({ resources }) => {\n    this.manage(resources) \n    if (this.bills.count > 0) {\n      this.workers.work({ resources })\n    }\n  }\n\n  orderIds = new Sequence()\n  order(count: number, itemName: string, account: Receivable): Bill {\n    const bill: Bill = {\n      id: this.orderIds.next,\n      order: { [itemName]: count },\n      account,\n      price: count\n    }\n    this.bills.add(bill)\n    return bill\n  }\n\n  get workers() { return this.people.lookup('Workers') }\n  private manage(resources: ManageStocks) {\n    if (this.bills.count === 0) return;\n\n    // const bill = this.bills.first;\n    this.bills.each(bill => {\n      const orderItemNames = Object.keys(bill.order)\n      const unfilled = this.unfulfilled(bill)\n      const allFulfilled = unfilled.length === 0\n\n      if (allFulfilled) {\n        bill.account.receive([], bill)\n        orderItemNames.forEach(item => {\n          this.resources.remove(bill.order[item], item)\n        })\n        this.bills.remove(bill)\n        this.emit('order:fulfilled', `An order for ${orderItemNames.join(',')} has been fulfilled`)\n      }\n    })\n\n    if (this.currentPolicy) {\n      this.currentPolicy.manage()\n    } else {\n      console.warn(\"No labor policy selected!\")\n    }\n  }\n}\n","export function unique(arr: any[]) {\n  var u = {}, a = [];\n  for (var i = 0, l = arr.length; i < l; ++i) {\n    if (!u.hasOwnProperty(arr[i])) {\n      a.push(arr[i]);\n      // @ts-ignore\n      u[arr[i]] = 1;\n    }\n  }\n  return a;\n}\n","import { Sequence } from '../collections';\nimport { Factory } from './Factory';\n\nconst ids = new Sequence()\n  const factory = new Factory('Zep');\n  factory.reboot();\n  factory.product('Soles', {});\n  factory.product('Laces', {});\n  factory.product('Socks', {});\n  factory.product('Shoes', { 'Soles': 2, 'Laces': 2 });\n  factory.product('Hat', {});\n  factory.product('Belt', {});\n  factory.product('Underwear', {});\n  factory.product('Pants', {});\n  factory.product('Outfit', { 'Pants': 1, 'Belt': 1, 'Hat': 1, 'Socks': 1, 'Shoes': 1 });\n  const managers = factory.people.create('Management')\n  managers.create('Operations Chief');\n  managers.create('Plant Manager');\n  // factory.workers.create('Engineer')\n  factory.machines.create('Robot')\n\n  factory.actions.create({ name: 'Spawn Worker', act: () => { factory.workers.create(`Employee #${ids.next}`); } });\n  export default factory;\n","import { Avernus } from \"./Avernus\"\nimport arena from \"./Arena\"\nimport { Society } from \"./Society\"\nimport zep from \"./zep\"\n\nconst models = [\n  arena,\n  zep,\n  Avernus,\n  Society\n]\n\nexport default models\n\n","\nimport './App.css';\nimport { IModel } from \"./ecosphere/Model/IModel\";\nimport { ModelSelector } from './ModelSelector';\nimport models from './examples';\n\ntype ApplicationProps = {\n  model: IModel\n}\n\nfunction App({ model: initialModel }: ApplicationProps) {\n\n  return <div className=\"App\">\n    {/* @ts-ignore */}\n    <ModelSelector models={models} initialModel={initialModel} />\n  </div>;\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport arena from './examples/Arena';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App model={arena} />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}