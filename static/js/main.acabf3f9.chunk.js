(this.webpackJsonpeco=this.webpackJsonpeco||[]).push([[0],{21:function(e,t,n){},22:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var a=n(7),r=n.n(a),i=n(15),s=n.n(i),o=(n(21),n(22),n(16)),c=n.n(o),u=(n(24),n(2)),l=n(3),h=n(12),d=n(10),p=n(9),f=n(8),m=n(6),v=n(13),g=n(4),b=n(5);function y(e,t){return function(n){return n[e]===t}}function j(e){return"string"===typeof e||e instanceof String}var O,k,w=n(1),x=function(){function e(t,n,a){Object(u.a)(this,e),this.idFor=t,this.nameFor=n,this.lookup=a,this._data={}}return Object(l.a)(e,[{key:"set",value:function(e,t){this._data[this.idFor(e)]=t}},{key:"get",value:function(e){return this._data[this.idFor(e)]}},{key:"report",get:function(){var e=this,t=Object.entries(this._data).map((function(t){var n=Object(w.a)(t,2),a=n[0],r=n[1];return[e.nameFor(e.lookup(Number(a))),r]}));return Object.fromEntries(t)}}]),e}(),E=function(){function e(){Object(u.a)(this,e),this.items=[]}return Object(l.a)(e,[{key:"it",get:function(){return this.items}},{key:"first",get:function(){return this.items[0]}},{key:"last",get:function(){return this.items[this.count-1]}},{key:"count",get:function(){return this.items.length}},{key:"add",value:function(e){this.items.push(e)}},{key:"remove",value:function(e){this.items=this.items.filter((function(t){return t!==e}))}},{key:"each",value:function(e){this.items.forEach(e)}},{key:"clear",value:function(){this.items=[]}},{key:"map",value:function(e){return this.items.map(e)}},{key:"sample",get:function(){throw new Error("Method not implemented.")}}]),e}(),P=function(){function e(){Object(u.a)(this,e),this.count=0}return Object(l.a)(e,[{key:"next",get:function(){return this.count++}}]),e}(),C=function(){function e(t,n){Object(u.a)(this,e),this.stocks=t,this.stockId=n}return Object(l.a)(e,[{key:"add",value:function(e){return this.stocks.add(e,this.name)}},{key:"remove",value:function(e){return this.stocks.remove(e,this.name)}},{key:"list",get:function(){return this.stocks.list()}},{key:"count",get:function(){return this.stocks.count(this.name)}},{key:"name",get:function(){return this.item.name}},{key:"item",get:function(){return this.stocks.lookupById(this.stockId)}}]),e}(),S=(O=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(u.a)(this,e),this.name=t,this.elements=n,this.ids=new P,this.storage={}}return Object(l.a)(e,[{key:"list",value:function(){return this.elements}},{key:"_store",get:function(){return this.storage}},{key:"clear",value:function(){this.elements=[],this.storage={}}},{key:"create",value:function(e){var t=null,n={};if(j(e))t=e,n.name=t;else{var a=e;t=a.name,n=Object(v.a)(a,["name"])}if(j(t)&&this.has(t))return this.manage(t);if(!j(t))throw new Error("Name must be a string");var r=this.ids.next,i=Object(m.a)({id:r,name:t},n);return this.list().push(i),this.manage(t)}},{key:"add",value:function(e,t){this.setAmount(t,this.count(t)+e)}},{key:"remove",value:function(e,t){this.setAmount(t,this.count(t)-e)}},{key:"zero",value:function(e){this.setAmount(e,0)}},{key:"count",value:function(e){var t=this.lookup(e);return this.storage[t.id]||0}},{key:"has",value:function(e){return!!this.elements.find(y("name",e))}},{key:"lookupById",value:function(e){var t=this.elements.find(y("id",e));if(t)return t;throw new Error("No such ".concat(this.name," with id ").concat(e))}},{key:"lookup",value:function(e){var t=this.elements.find(y("name",e));return t||this.create(e).item}},{key:"report",get:function(){var e=this;return this.list().flatMap((function(t){var n=Number(t.id),a=e.storage[n]||0;return Object(m.a)(Object(m.a)({},t),{},{amount:a})}))}},{key:"manage",value:function(e){return new C(this,this.lookup(e).id)}},{key:"manageAll",value:function(){var e=this;return{add:this.add,remove:this.remove,count:this.count,list:function(){return e.elements}}}},{key:"manager",get:function(){return this.manageAll()}},{key:"setAmount",value:function(e,t){var n=this.lookup(e);this.storage[n.id]=t}}]),e}(),Object(g.a)(O.prototype,"list",[b.a],Object.getOwnPropertyDescriptor(O.prototype,"list"),O.prototype),Object(g.a)(O.prototype,"create",[b.a],Object.getOwnPropertyDescriptor(O.prototype,"create"),O.prototype),Object(g.a)(O.prototype,"add",[b.a],Object.getOwnPropertyDescriptor(O.prototype,"add"),O.prototype),Object(g.a)(O.prototype,"remove",[b.a],Object.getOwnPropertyDescriptor(O.prototype,"remove"),O.prototype),Object(g.a)(O.prototype,"zero",[b.a],Object.getOwnPropertyDescriptor(O.prototype,"zero"),O.prototype),Object(g.a)(O.prototype,"count",[b.a],Object.getOwnPropertyDescriptor(O.prototype,"count"),O.prototype),Object(g.a)(O.prototype,"lookupById",[b.a],Object.getOwnPropertyDescriptor(O.prototype,"lookupById"),O.prototype),O),M=(k=function(){function e(t,n){Object(u.a)(this,e),this.name=t,this.popCtor=n,this.populations={},this.species={}}return Object(l.a)(e,[{key:"clear",value:function(){this.populations={}}},{key:"lookup",value:function(e){if(this.has(e))return this.populations[e];throw new Error("No such ".concat(this.name," '").concat(e,"'"))}},{key:"lookupById",value:function(e){var t=Object.values(this.species).find((function(t){return t.id===e}));if(t)return t;throw new Error("No such ".concat(this.name," '").concat(e,"'"))}},{key:"has",value:function(e){return this.populations.hasOwnProperty(e)}},{key:"count",value:function(e){return this.lookup(e).count}},{key:"list",value:function(){return Object.values(this.species)}},{key:"listByName",value:function(e){return this.lookup(e).list()}},{key:"create",value:function(e,t){if(this.has(e))return this.lookup(e);var n=Object(m.a)(Object(m.a)({},t),{},{name:e,id:this.list().length+1}),a=new this.popCtor(e,n);return this.populations[e]=a,this.species[e]=n,a}},{key:"populationList",get:function(){return Object.values(this.populations)}},{key:"report",get:function(){return this.populationList.flatMap((function(e){var t=e;return t.count>0?{name:t.name,amount:t.count}:[]}))}},{key:"add",value:function(e,t){this.lookup(t).add(e)}},{key:"remove",value:function(e,t){this.lookup(t).remove(e)}},{key:"manageAll",value:function(){return{add:this.add,remove:this.remove,count:this.count,list:this.list}}},{key:"manager",get:function(){return this.manageAll()}}]),e}(),Object(g.a)(k.prototype,"lookup",[b.a],Object.getOwnPropertyDescriptor(k.prototype,"lookup"),k.prototype),Object(g.a)(k.prototype,"lookupById",[b.a],Object.getOwnPropertyDescriptor(k.prototype,"lookupById"),k.prototype),Object(g.a)(k.prototype,"count",[b.a],Object.getOwnPropertyDescriptor(k.prototype,"count"),k.prototype),Object(g.a)(k.prototype,"list",[b.a],Object.getOwnPropertyDescriptor(k.prototype,"list"),k.prototype),Object(g.a)(k.prototype,"create",[b.a],Object.getOwnPropertyDescriptor(k.prototype,"create"),k.prototype),Object(g.a)(k.prototype,"add",[b.a],Object.getOwnPropertyDescriptor(k.prototype,"add"),k.prototype),Object(g.a)(k.prototype,"remove",[b.a],Object.getOwnPropertyDescriptor(k.prototype,"remove"),k.prototype),k),N=function(){function e(t,n){Object(u.a)(this,e),this.model=t,this.getStocks=n,this.changes=void 0;var a=this.getStocks(t);this.changes=new S("".concat(a.name," (delta)"),a.list())}return Object(l.a)(e,[{key:"storage",get:function(){return this.changes._store}}]),e}(),I=function(){function e(t){Object(u.a)(this,e),this.name=t,this.ticks=0,this.tracking=[],this.dynamics=new E}return Object(l.a)(e,[{key:"evolve",value:function(e){this.dynamics.add(e)}},{key:"step",value:function(){return this.flux(this.ticks++)}},{key:"report",get:function(){var e=this;return Object.fromEntries(this.tracking.map((function(t){return[t,e[t].report]})))}},{key:"flow",value:function(e){var t=this[e],n=new N(this,(function(t){return t[e]})),a=n.changes.manager,r=a.add,i=a.remove,s=t.list,o=t.count;return{lookupById:t.lookupById,_delta:n,add:r,remove:i,list:s,count:o}}},{key:"flows",value:function(){var e=this,t={};return this.tracking.forEach((function(n){return t[n]=e.flow(n)})),t}},{key:"flowsReport",value:function(e){var t={};return Object.entries(e).forEach((function(e){var n=Object(w.a)(e,2),a=n[0],r=n[1],i=r._delta;t[a]=Object.fromEntries(Object.entries(i.storage).map((function(e){var t=Object(w.a)(e,2),n=t[0],a=t[1];return[r.lookupById(Number(n)).name,a]})))})),t}},{key:"flux",value:function(e){var t=this,n=this.flows();return this.dynamics.each((function(t){return t(n,e)})),Object.entries(n).forEach((function(e){var n=Object(w.a)(e,2),a=n[0],r=n[1]._delta;t.apply(r,a)})),{changed:this.flowsReport(n)}}},{key:"apply",value:function(e,t){var n=this[t].manager,a=n.list(),r=e.storage,i={};return a.forEach((function(e){if(r[e.id]){var t=r[e.id];n.add(t,e.name),i[e.name]=t}})),{changed:i}}}]),e}(),D=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).ids=new P,e}return Object(l.a)(n,[{key:"list",value:function(){return this.items}},{key:"names",get:function(){return this.items.map((function(e){return e.name}))}},{key:"create",value:function(e){var t=this.ids.next,n=Object(m.a)({id:t},e);return this.items.push(n),n}},{key:"lookup",value:function(e){return this.items.find((function(t){return t.name===e}))}}]),n}(E);function F(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function B(e){return e[F(0,e.length-1)]}var A,G,R=new P,T=function(e,t){return{id:R.next,name:e,kind:t,age:0,health:B(["dying","unwell","flourishing","triumphant"]),spirit:B(["languorous","vigorous","impetuous","ferocious"]),cunning:B(["dim","attentive","creative","ingenious"]),agility:B(["clumsy","nimble","spry","balletic"]),strength:B(["weak","robust","mighty","indomitable"])}},H=new P,V=new P,L={id:-1,name:"Human Being",size:"medium"},W=function(){function e(){Object(u.a)(this,e)}return Object(l.a)(e,null,[{key:"first",value:function(e){return e.values().next().value}}]),e}(),_=new P,U=(A=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;Object(u.a)(this,e),this.name=t,this.species=n,this.individuals=a,this.id=_.next,this.ids=new P}return Object(l.a)(e,[{key:"list",value:function(){var e=[];return this.individuals.forEach((function(t){return e.push(t)})),e}},{key:"count",get:function(){return this.individuals.size}},{key:"first",get:function(){return W.first(this.individuals)}},{key:"lookup",value:function(e){var t=null;if(this.individuals.forEach((function(n){n.name===e&&(t=n)})),t)return t;throw new Error("Could not find individual with name '".concat(e,"' in the population of ").concat(this.name))}},{key:"lookupById",value:function(e){var t=null;if(this.individuals.forEach((function(n){n.id===e&&(t=n)})),t)return t;throw new Error("Could not find individual with id ".concat(e," in the population of ").concat(this.name))}},{key:"birth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat(this.name," ").concat(this.count),t=this.create(e);return t}},{key:"death",value:function(e){if(e){var t=this.destroy(e);if(t)return t}else{var n=this.first;if(n)return this.destroy(n.name),n}throw new Error("Population already empty!")}},{key:"add",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.birth());return t}},{key:"remove",value:function(e){for(var t=[],n=0;n<Math.min(this.count,e);n++)t.push(this.death(this.first.name));return t}},{key:"build",value:function(e){var t=null,n={};if(j(e))t=e,n.name=t;else{var a=e;t=a.name,n=Object(v.a)(a,["name"])}var r=this.ids.next;return Object(m.a)({id:r,name:t},n)}},{key:"create",value:function(e){var t=this.build(e);return this.individuals.add(t),t}},{key:"destroy",value:function(e){var t=this.lookup(e);return this.individuals.delete(t),t}},{key:"report",get:function(){return Object.fromEntries(this.list().map((function(e){return[e.id,e.name]})))}}]),e}(),Object(g.a)(A.prototype,"lookupById",[b.a],Object.getOwnPropertyDescriptor(A.prototype,"lookupById"),A.prototype),Object(g.a)(A.prototype,"death",[b.a],Object.getOwnPropertyDescriptor(A.prototype,"death"),A.prototype),Object(g.a)(A.prototype,"create",[b.a],Object.getOwnPropertyDescriptor(A.prototype,"create"),A.prototype),Object(g.a)(A.prototype,"destroy",[b.a],Object.getOwnPropertyDescriptor(A.prototype,"destroy"),A.prototype),A),z=(G=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).moieties=new E,e.obscured=!1,e.recipes=new D,e.jobs=new x((function(e){return e.id}),(function(e){return e.name}),e.lookupById),e.inventories=new x((function(e){return e.id}),(function(e){return e.name}),e.lookupById),e}return Object(l.a)(n,[{key:"report",get:function(){var e=this,t=this.list().map((function(t){return[t.id,(e.jobs.get(t)||{name:"?"}).name]}));return Object.fromEntries(t)}},{key:"create",value:function(e){var t=Object(h.a)(Object(d.a)(n.prototype),"build",this).call(this,e),a=t.name,r=t.age,i=function(e,t){var n=new S("".concat(e,"'s Things")),a=new S("".concat(e,"'s Traits"));return{id:V.next,kind:t,name:e,age:0,body:T(e,L),mind:{insight:B(["dense","intuitive","incisive","brilliant"]),depth:B(["superficial","substantial","profound","inscrutable"]),education:B(["unlettered","literate","tutored","well-read"]),disposition:B(["dismal","hopeful","propitious","roseate"])},soul:{wit:B(["slow","clever","biting","savage"]),empathy:B(["sadistic","generous","benevolent","selfless"]),integrity:B(["uncertain","sound","solid","incorruptible"]),beauty:B(["ugly","fair","radiant","resplendent"])},currency:0,things:n.manageAll(),traits:a.manageAll()}}(a,function(e){var t=B(["impoverished","well-off","luxuriant","decadent"]),n=B(["unpretentious","savvy","urbane","sleek"]),a=B(["inconsequential","marginal","influential","sovereign"]),r=B(["clueless","well-informed","wise","prescient"]);return{id:H.next,name:e,wealth:t,sophistication:n,power:a,knowledge:r}}("".concat(a,"'s Gens")));return i.age=r,this.individuals.add(i),i}},{key:"work",value:function(e){var t=this,n=e.resources,a=this.jobs.report;Object.entries(a).forEach((function(e){var a=Object(w.a)(e,2),r=(a[0],a[1]);t.produce(r,n)}))}},{key:"produce",value:function(e,t){this.mayProduce(e,t)&&(e.consumes&&Object.entries(e.consumes).forEach((function(e){var n=Object(w.a)(e,2),a=n[0],r=n[1];t.remove(r,a)})),Object.entries(e.produces).forEach((function(e){var n=Object(w.a)(e,2),a=n[0],r=n[1];t.add(r,a)})))}},{key:"mayProduce",value:function(e,t){var n=!0;return e.consumes&&Object.entries(e.consumes).forEach((function(e){var a=Object(w.a)(e,2),r=a[0],i=a[1];t.count(r)<i&&(n=!1)})),n}}]),n}(U),Object(g.a)(G.prototype,"create",[b.a],Object.getOwnPropertyDescriptor(G.prototype,"create"),G.prototype),G),q=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).tracking=["animals","resources"],e.people=new M("people",z),e.resources=new S("resources"),e.machines=new S("machines"),e.animals=new M("wildlife",U),e.metrics={},e.actions=new D,e.policies=new D,e.currentPolicy=void 0,e}return Object(l.a)(n,[{key:"reset",value:function(){this.resources.clear(),this.machines.clear(),this.animals.clear(),this.people.clear(),this.dynamics.clear()}},{key:"send",value:function(e,t){var n=this.actions.lookup(e);if(!n)throw new Error("No such action ".concat(e));n.act(t)}},{key:"choose",value:function(e){var t=this.policies.lookup(e);if(!t)throw new Error("No such policy ".concat(e));this.currentPolicy=t}},{key:"step",value:function(){return this.currentPolicy&&this.currentPolicy.manage(),Object(h.a)(Object(d.a)(n.prototype),"step",this).call(this)}}]),n}(I);var Q=n(0);function J(e){return function(t){var n=t.name,a=t.amount,r=e&&e[n];return Object(Q.jsxs)("li",{title:n,className:"Item",children:[Object(Q.jsx)("span",{className:"Title","data-testid":"Name",children:n}),Object(Q.jsx)("span",{"data-testid":"Count",children:a}),Object(Q.jsx)("span",{"data-testid":"Delta",children:r})]},n)}}n(26);function Z(e){var t=e.children,n=e.title;return Object(Q.jsxs)("div",{className:"Tile",title:n,children:[Object(Q.jsx)("h5",{className:"Title",children:n}),t]})}function K(e){return Object(Q.jsx)(Z,{title:e.name,children:Object(Q.jsx)("ul",{"aria-label":"People",children:e.obscured?e.list().map((function(e){return Object(Q.jsx)("li",{children:e.name},e.id)})):e.list().map((t=e.report,function(e){var n=e.id,a=e.name,r=e.things,i=e.traits,s=r.list().map((function(e){return e.name}));return Object(Q.jsxs)("li",{title:a,className:"Item",children:[Object(Q.jsx)("div",{className:"Title","data-testid":"Name",children:a}),t[n]&&"?"!==t[n]&&Object(Q.jsx)("span",{"data-testid":"Status",children:t[n]}),s.length>0&&Object(Q.jsx)("div",{className:"Subitems","data-testid":"Inventory",children:Object(Q.jsx)("ul",{children:s.sort((function(e,t){return e>t?1:-1})).map((function(e){return Object(Q.jsxs)("li",{style:Object(m.a)({},0===r.count(e)?{display:"none"}:{}),children:[e," ",Object(Q.jsx)("span",{"data-testid":e,className:"Count",children:r.count(e)})]},e)}))})}),i.list().length>0&&Object(Q.jsx)("div",{className:"Traits","data-testid":"Trait Ranks",children:Object(Q.jsx)("ul",{children:i.list().map((function(e){return Object(Q.jsxs)("li",{style:Object(m.a)({},0===i.count(e.name)?{display:"none"}:{}),children:[e.name," ",Object(Q.jsx)("span",{"data-testid":e.name,children:i.count(e.name)})]},e.id)}))})})]},n)}))})},e.id);var t}function X(e){var t=e.modelName,n=e.items,a=e.communities,r=e.machines,i=e.animals,s=e.lastChanges,o=e.metrics,c=a.map(K);return Object(Q.jsxs)("div",{className:"Model",children:[Object(Q.jsx)("h4",{"aria-label":"Model Title",style:{display:"none"},children:t}),n.length>0&&Object(Q.jsx)(Z,{title:"Items",children:Object(Q.jsx)("ul",{"aria-label":"Resources",children:n.map(J(s.resources))})}),i.length>0&&Object(Q.jsx)(Z,{title:"Animals",children:Object(Q.jsx)("ul",{"aria-label":"Animals",children:i.map(J(s.animals))})}),a.length>0&&Object(Q.jsx)("div",{title:"Individuals",style:{display:"flex"},children:c}),r.length>0&&Object(Q.jsx)(Z,{title:"Machines",children:Object(Q.jsx)("ul",{children:r.map((function(e){var t=e.name;return Object(Q.jsx)("li",{children:t},t)}))})}),Object.keys(o).length>0&&Object(Q.jsx)(Z,{title:"Metrics",children:Object(Q.jsx)("ul",{children:Object.entries(o).map((function(e){var t=Object(w.a)(e,2),n=t[0],a=t[1];return Object(Q.jsxs)("li",{title:n,children:[n,Object(Q.jsx)("span",{"data-testid":"Count",children:a})]},n)}))})})]})}var Y=q,$=function(e,t){var n=e.actions,a=e.resources,r=e.people,i=e.machines,s=e.animals,o=e.metrics;return{modelName:e.name,items:a.report,communities:r.populationList,machines:i.list(),animals:s.report,actions:n.list(),metrics:Object.fromEntries(Object.entries(o).map((function(e){var t=Object(w.a)(e,2);return[t[0],(0,t[1])()]}))),lastChanges:t}};function ee(e){var t=e.model,n=e.send,a=e.choose,r=e.step,i=e.lastChanges;return Object(Q.jsxs)(Q.Fragment,{children:[Object(Q.jsx)("div",{"aria-label":"View",children:Object(Q.jsx)(X,Object(m.a)({},$(t,i)))}),Object(Q.jsxs)("div",{"aria-label":"Controls",children:[Object(Q.jsx)("span",{title:"Run",style:{display:"none"},children:Object(Q.jsx)("button",{onClick:function(){return r(!0)},children:"Step"})}),Object(Q.jsx)("span",{title:"Actions",children:t.actions.list().map((function(e){var t=e.name;return Object(Q.jsx)("button",{title:t,onClick:function(){return n(t)},children:t},t)}))}),t.policies.count>0&&Object(Q.jsx)("div",{className:"Policy",title:"Policies",children:t.policies.list().map((function(e){var n,r=e.name;return Object(Q.jsxs)("label",{children:[Object(Q.jsx)("input",{type:"radio",checked:(null===(n=t.currentPolicy)||void 0===n?void 0:n.name)===r,title:r,onChange:function(){return a(r)}},r),r]},r)}))})]})]})}function te(e){var t=Object(a.useState)(e),n=Object(w.a)(t,2),r=n[0],i=n[1],s=Object(a.useState)({}),o=Object(w.a)(s,2),c=o[0],u=o[1],l=Object(a.useState)(2),h=Object(w.a)(l,2),d=h[0],p=h[1],f=Object(a.useState)(!1),m=Object(w.a)(f,2),v=m[0],g=m[1],b=Object(a.useState)(!1),y=Object(w.a)(b,2),j=y[0],O=y[1],k=Object(a.useState)(!1),x=Object(w.a)(k,2),E=x[0],P=x[1],C=Object(a.useState)(""),S=Object(w.a)(C,2),M=S[0],N=S[1],I=Object(a.useState)(""),D=Object(w.a)(I,2),F=D[0],B=D[1];Object(a.useEffect)((function(){j&&(M&&ne(r)&&r.send(M,{}),O(!1))}),[M,r,j]),Object(a.useEffect)((function(){E&&(F&&ne(r)&&r.choose(F,{}),P(!1))}),[F,r,E]);return Object(a.useEffect)((function(){if(v&&ne(r)){var e=r.step().changed;g(!1),u(e)}}),[v,r]),function(e,t){var n=Object(a.useRef)();Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){function e(){n.current()}if(null!==t){var a=setInterval(e,t);return function(){return clearInterval(a)}}}),[t])}((function(){return g(!0)}),d),{model:r,step:function(){g(!0)},lastChanges:c,send:function(e,t){return function(e,t){N(e),O(!0)}(e)},choose:function(e,t){return function(e,t){B(e),P(!0)}(e)},setDelay:p,setModel:i}}var ne=function(e){return e instanceof Y},ae=function(e){var t=e.assembly;return Object(Q.jsx)(Q.Fragment,{children:t.models.items.map((function(e){var t=te(e),n=t.step,a=t.send,r=t.choose,i=t.lastChanges,s=t.model;return Object(Q.jsxs)(Q.Fragment,{children:[Object(Q.jsx)("h4",{children:e.name}),Object(Q.jsx)(ee,{step:n,send:a,model:s,choose:r,lastChanges:i},s.name)]})}))})};function re(e){var t=e.initialModel,n=e.models,a=te(t),r=a.step,i=a.send,s=a.choose,o=a.lastChanges,u=a.model,l=a.setModel;return Object(Q.jsxs)(Q.Fragment,{children:[Object(Q.jsx)(c.a,{options:n.map((function(e){return e.name})),onChange:function(e){var t=e.value,a=n.find((function(e){return e.name===t}));a&&l(a)},value:u.name,placeholder:"Select a model"}),ne(u)?Object(Q.jsx)(ee,{step:r,send:i,model:u,choose:s,lastChanges:o}):Object(Q.jsx)(ae,{assembly:u})]})}var ie=function(e,t,n,a){t.things.remove(n,a),e.things.add(n,a)},se=new Y("Avernus"),oe=se.resources,ce=se.animals,ue=se.people.create("Townspeople"),le=ue.recipes,he=ue.jobs;ce.create("Fish");var de=ue.create("Goldstrom"),pe=ue.create("Octavius"),fe=ue.create("Smeltmore"),me=ue.create("Harold");oe.create("Gold Ore"),oe.create("Gold Deposit"),oe.create("Gold Bar"),oe.create("Gold Coin"),oe.add(1e8,"Gold Deposit");var ve=le.create({name:"Mining Gold",produces:{"Gold Ore":1},consumes:{"Gold Deposit":10}}),ge=le.create({name:"Smelt Gold",produces:{"Gold Bar":1},consumes:{"Gold Ore":10}}),be=le.create({name:"Minting Gold Coins",produces:{"Gold Coin":10},consumes:{"Gold Bar":1}});he.set(de,ve),he.set(pe,be),he.set(fe,ge),se.evolve((function(e,t){var n=e.resources,a=e.animals;(ue.work({resources:n}),t%10===0)&&[de,pe,fe].forEach((function(e){e.things.add(1,"Gold Coin"),n.remove(1,"Gold Coin")}));t%10===0&&(me.things.add(1,"Fish"),a.remove(1,"Fish")),[de,pe,fe].forEach((function(e){me.things.count("Fish")>3&&e.things.count("Gold Coin")>5&&(ie(me,e,5,"Gold Coin"),ie(e,me,1,"Fish"))}))}));var ye,je=function(){function e(){Object(u.a)(this,e),this.basicCreatures={"Dancing Light":{hp:24,evasion:1},"Crystalline Fog":{hp:26,evasion:1,reflect:10},"Floating Light":{hp:28,evasion:1,speed:1},"Mobile Wisp":{hp:40,strength:1,speed:1,evasion:1}},this.challengingCreatures={Gremlin:{hp:32,speed:1,counter:1,evasion:1},Goblin:{hp:40},Kobold:{hp:50,strength:1,speed:2},Orc:{hp:64,strength:2,speed:1,counter:1}},this.uncommonCreatures={Rat:{hp:14,strength:1,speed:3,evasion:1},Bat:{hp:18,strength:2,speed:2,evasion:1},Snake:{hp:15,strength:3,speed:2,evasion:2},Blob:{hp:24,strength:2,speed:1,evasion:1},Bear:{hp:30,strength:3,speed:2,evasion:1},Ghost:{hp:70,"magic damage":1,evasion:1,counter:1,speed:1,absorb:1,defense:1},Rogue:{hp:74,strength:2,speed:1,"bonus damage":2,evasion:2,counter:2},Troll:{hp:83,strength:2,speed:2,regen:1,counter:1},Giant:{hp:95,strength:2,speed:2,defense:1,absorb:1}},this.bosses={Priest:{hp:57,heal:4,"holy damage":6,defense:6,"holy defense":3,evasion:2},Vampire:{hp:84,strength:2,speed:3,"magic damage":1,absorb:2,evasion:2},Drake:{hp:100,strength:3,speed:2,regen:2,"magic damage":2,evasion:2},Lich:{hp:140,strength:4,speed:6,defense:6,"magic damage":6,evasion:6}},this.extraplanar={Demon:{hp:166,strength:3,speed:6,counter:6,evasion:6},Angel:{hp:199,evasion:2,absorb:2,regen:2,counter:9,defense:9,"magic defense":2,"holy damage":9},Archdemon:{hp:366,absorb:6,strength:6,speed:6,defense:6,evasion:6,"magic damage":6,"holy damage":16},Dracolith:{hp:247,strength:7,"magic damage":7,speed:7,defense:7,evasion:7,counter:7},Archangel:{hp:299,absorb:9,strength:9,speed:9,defense:9,evasion:9,"magic defense":9,"holy defense":9,"holy damage":99},"Floating Sigil":{hp:234,speed:10,defense:10,counter:10},"Astral Filament":{hp:1234,strength:15,absorb:10,evasion:5,counter:1,regen:1},"Essence Sphere":{hp:12345,"magic damage":12,"holy damage":12,"bonus damage":12}},this.dragons={"Green Dragon":{hp:900,strength:5,speed:8,defense:4,"magic damage":16,evasion:24},"Red Dragon":{hp:1100,strength:7,speed:9,defense:14,"magic damage":26,evasion:34},"Blue Dragon":{hp:2100,strength:9,speed:11,defense:24,"magic damage":36,evasion:44},"Golden Dragon":{hp:2400,strength:11,speed:15,defense:34,"magic damage":66,evasion:55},"Black Dragon":{hp:2900,strength:11,speed:15,defense:34,"magic damage":66,evasion:55},"Primordial Dragon":{hp:3919,strength:30,speed:30,defense:30,"magic damage":30,evasion:30}},this.rareCreatures=Object(m.a)(Object(m.a)({"Eldritch Lich":{hp:2500,strength:8,speed:6,defense:4,"magic damage":13,evasion:5},"Primordial Vampire":{hp:3800,strength:3,speed:10,defense:10,"holy defense":10,"magic defense":10,"magic damage":3,evasion:3,absorb:4},Leviathan:{hp:9999,strength:10,speed:10,defense:25,evasion:25,counter:25}},this.extraplanar),this.dragons),this.bestiary=Object(m.a)(Object(m.a)(Object(m.a)(Object(m.a)(Object(m.a)({},this.basicCreatures),this.uncommonCreatures),this.challengingCreatures),this.rareCreatures),this.bosses),this.basicSubtypes={Hostile:{strength:1},Intimidating:{strength:2},Nimble:{speed:1},Quick:{speed:2},Timid:{evasion:1},Spry:{evasion:2},Vigilant:{regen:1},Relentless:{regen:2},Armored:{defense:1},Hardened:{defense:2},Benevolent:{heal:1},Protective:{heal:2},Snarling:{counter:1},Emboldened:{"bonus damage":1}},this.rareSubtypes={Elusive:{evasion:3},Voracious:{hp:5,strength:1,speed:1},Vicious:{hp:10,strength:1,defense:1},Vexatious:{hp:15,counter:1,evasion:1},Arrogant:{hp:-5,evasion:1,counter:1,speed:1},Adventurous:{hp:10,"bonus damage":2},Questing:{hp:20,"bonus damage":3},Silvered:{reflect:1},Mirrored:{reflect:2},Aggressive:{strength:3},Dominating:{strength:4},Swift:{speed:3},Accelerated:{speed:4},Reluctant:{evasion:5},Hidden:{evasion:10},Invisible:{evasion:15},Resurrecting:{regen:3},Regenerating:{regen:4},Fortified:{defense:3},Angelic:{heal:3},Prismatic:{reflect:3},Pugnacious:{"bonus damage":1,evasion:1,counter:1},Augmented:{strength:1,"magic damage":1,"bonus damage":1},Skillful:{defense:1,strength:1,speed:1,evasion:1,counter:1},Skeletal:{hp:-1,evasion:2,absorb:1,regen:1},Undead:{hp:-1,strength:1,regen:1,absorb:1,speed:1,evasion:1},Zombie:{hp:-2,evasion:1,regen:2,strength:1},Favored:{hp:1,strength:2,speed:2,"magic damage":1,regen:1,evasion:1},Fiendish:{hp:2,strength:3,speed:3,defense:1,regen:1,evasion:2},Fierce:{hp:2,strength:4,speed:4,defense:2,absorb:2,evasion:3},Opalescent:{hp:2,reflect:4,absorb:2,evasion:2,counter:2,heal:2},Cruel:{hp:3,strength:5,speed:5,"magic damage":3,"bonus damage":2,absorb:3,regen:1,evasion:4},Vortex:{hp:1,reflect:10,absorb:10,evade:50,counter:50},Shadow:{hp:2,"magic damage":20,absorb:20,evade:20,counter:20},Luminous:{hp:3,"holy damage":20,absorb:20,evade:20,counter:20},Defiant:{hp:1,"bonus damage":20,absorb:20,evade:20,counter:20},Devious:{hp:2,evasion:2,counter:20,absorb:20},Draconic:{hp:3,"magic damage":1,counter:20,absorb:20}},this.subtypes=Object(m.a)(Object(m.a)({Common:{},Evasive:{evasion:3,counter:2},Retaliatory:{defense:1,counter:2},Inspired:{"bonus damage":1},Infused:{"bonus damage":2,"magic damage":1},Radiant:{"holy damage":1},Resplendent:{"holy damage":2,strength:1,speed:1},Heavy:{strength:2,defense:2},Titanic:{strength:4,defense:2},Unholy:{"magic damage":1,"holy defense":1},Blessed:{"holy damage":1,absorb:1},Adept:{evasion:1,counter:1,defense:1,strength:1}},this.basicSubtypes),this.rareSubtypes),this.perks={Piercing:{hp:15,strength:1,defense:1,evasion:1,"bonus damage":1},Blessed:{hp:15,absorb:1,defense:1,regen:1,"holy damage":1},Enchanted:{hp:15,defense:1,evasion:1},Clockwork:{hp:15,defense:1,speed:2,evasion:1},Phantasmal:{hp:25,defense:1,evasion:4},Cosmic:{hp:30,defense:3,evasion:3,strength:3},Imperious:{hp:40,defense:4,"magic damage":3,speed:3}},this.monsterIds=new P,this.difficulty=1}return Object(l.a)(e,[{key:"generateBasicMonster",value:function(e){var t=B(Object.keys(this.basicCreatures));e.name="".concat(t," (").concat(this.monsterIds.next,")");Object.entries(this.bestiary[t]).forEach((function(t){var n=Object(w.a)(t,2),a=n[0],r=n[1];return e.things.add(Math.floor(1*r),a)})),Object.entries(this.subtypes.Common).forEach((function(t){var n=Object(w.a)(t,2),a=n[0],r=n[1];return e.things.add(Math.floor(1*r),a)}))}},{key:"generate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t<=8)this.generateBasicMonster(e);else{var n=B(Object.keys(this.challengingCreatures)),a=F(0,20)>16?B(Object.keys(this.basicSubtypes)):"Common";t>=20&&F(0,20)>19&&(a=B(Object.keys(this.subtypes))),t>=25&&F(0,20)>19&&(n=B(Object.keys(this.bestiary)));var r="Common"===a?n:[a,n].join(" ");e.name="".concat(r," (").concat(this.monsterIds.next,")");var i=.0015*t*t,s=this.difficulty+2*i;Object.entries(this.bestiary[n]).forEach((function(t){var n=Object(w.a)(t,2),a=n[0],r=n[1];return e.things.add(Math.floor(r*s),a)})),Object.entries(this.subtypes[a]).forEach((function(t){var n=Object(w.a)(t,2),a=n[0],r=n[1];return e.things.add(Math.floor(r*s),a)})),e.things.add(e.things.count("hp"),"max hp"),t>=15&&(e.things.add(F(1,t/2),"defense"),e.things.add(F(1,t/2),"strength")),t>=25&&(e.things.add(F(1,t/2),"evasion"),e.things.add(F(1,t/2),"counter")),t>=35&&(e.things.add(F(1,t/2),"magic damage"),e.things.add(F(1,t/2),"chain chance")),t>=45&&(e.things.add(F(1,t/2),"holy damage"),e.things.add(F(1,t/2),"reflect"))}}},{key:"generateBoss",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=B(Object.keys(this.bosses)),a=B(Object.keys(this.rareSubtypes)),r=B(Object.keys(this.perks)),i=[r,a,n].join(" ");e.name=i;var s=this.difficulty+.01*t;Object.entries(this.bestiary[n]).forEach((function(t){var n=Object(w.a)(t,2),a=n[0],r=n[1];return e.things.add(Math.floor(r*s),a)})),Object.entries(this.rareSubtypes[a]).forEach((function(t){var n=Object(w.a)(t,2),a=n[0],r=n[1];return e.things.add(Math.floor(r*s),a)})),Object.entries(this.perks[r]).forEach((function(t){var n=Object(w.a)(t,2),a=n[0],r=n[1];return e.things.add(Math.floor(r*s),a)})),e.things.add(e.things.count("hp"),"max hp")}}]),e}(),Oe=function(){function e(){Object(u.a)(this,e)}return Object(l.a)(e,null,[{key:"generate",value:function(e,t){e.traits.add(1,t),e.things.add(42,"hp");var n=this.characterClasses[t];Object.keys(n.attributes).forEach((function(t){var a=n.attributes[t];e.things.add(a,t)})),n.traits.forEach((function(t){return e.traits.add(1,t)})),e.things.add(2e3,"xp per li"),e.things.add(Math.floor(31.5),"hp per victory"),e.things.add(Math.floor(50.4),"max hp"),e.traits.add(3,"Potion of Life"),e.things.add(1,"level");for(var a=0;a<10;a++)this.levelUp(e)}},{key:"levelUp",value:function(e){var t=this,n={common:8,uncommon:5,rare:3,epic:2,legendary:1};Object.keys(this.attributes).forEach((function(a){for(var r=0;r<n[a];r++){var i=B(t.attributes[a]);if(i){e.things.add(1,i),console.log("".concat(i," improves by ").concat(1))}}}));var a={common:2,uncommon:3,rare:5,epic:8,legendary:13};Object.keys(this.perks).forEach((function(n){if(e.things.count("level")%a[n]===0){var r=B(t.perks[n]);r&&(console.log("Gain a rank in ".concat(r," (").concat(n,")")),e.traits.add(1,r))}})),e.things.count("level")%3===0&&e.traits.list().forEach((function(n){Object.keys(t.characterClasses).includes(n.name)&&Object.entries(t.characterClasses[n.name].attributes).forEach((function(t){var a=Object(w.a)(t,2),r=a[0],i=a[1],s=i>0?F(1,Math.max(1,i)):1;console.log("".concat(r," improves by ").concat(s," (").concat(n.name,")")),e.things.add(s,r)}))}))}}]),e}();Oe.characterClasses={Fighter:{attributes:{hp:12,strength:1,defense:1,speed:0,"bonus damage":0,"chain chance":0,"max chain":0},traits:["Fitness","Combat Veteran"]}},Oe.attributes={common:["max hp"],uncommon:[],rare:[],epic:[],legendary:[]},Oe.perkBenefits={"Cloaking Robe of Elvenkind":{"magic damage":.05,"magic defense":.5,evasion:.25,"holy defense":.05},"Combat Veteran":{strength:.05,defense:.05,counter:.05,evasion:.05,"crit damage":.05,"bonus damage":.05},"Fine Raiment":{"magic damage":.1,"magic defense":.2,defense:.15,evasion:.1},"Holy Symbol":{"holy damage":.5,"holy defense":.15,heal:.1,regen:.1},"Royal Armorer":{defense:.5,"holy defense":.25,"magic defense":.25,evasion:.25},Brutality:{strength:.5,speed:.25,"bonus damage":.25,"max chain":.1},Counterweight:{counter:.5,evasion:.1,"crit damage":.05,"max chain":.1},Efferverscence:{regen:.25,counter:.25,"crit damage":.25,"holy defense":.25,"max chain":.25},Efficacious:{counter:.1,evasion:.1,"bonus damage":.1,strength:.1,defense:.1,"magic defense":.1,heal:.1},Opalescence:{reflect:.2,absorb:.2,evasion:.2,defense:.2,regen:.2,heal:.2},Ethereal:{"magic damage":.25,"magic defense":.25,evasion:.5,defense:.25},Faith:{"holy damage":.25,"holy defense":.5,heal:.25,regen:.1},Finesse:{"crit chance":.25,"crit damage":.15,"max chain":.05,"chain chance":.1},Fitness:{strength:.1,defense:.1,speed:.1,evasion:.1,counter:.1,regen:.1},Fluidity:{"crit chance":.1,"crit damage":.1,evasion:.1,counter:.1,speed:.1},Dexterity:{defense:.25,"magic defense":.1,speed:.1,evasion:.1,"chain chance":.1},Precision:{speed:.1,"crit damage":.25,evasion:.05,"max chain":.1},Swiftness:{speed:.2,counter:.15,"crit chance":.15,defense:.1},Rapidity:{speed:.5,counter:.1,"crit damage":.25,evasion:.1},Medic:{heal:.5,regen:.1,absorb:.1,defense:.1},Vitality:{strength:.1,speed:.25,regen:.5,heal:.1},Whirlwind:{"chain chance":.5,"max chain":.5,"damage to all":.5,"bonus damage":.1},Focus:{"magic damage":.5,"magic defense":.25,"holy damage":.1,"holy defense":.5},Iridescence:{"magic damage":.5,"holy damage":.5,"bonus damage":.5,"damage to all":.5},Concentration:{"magic defense":.25,"holy defense":.5,defense:.1,evasion:.1,counter:.1},Salvation:{"holy damage":.5,"holy defense":.2,defense:.1,reflect:.1,absorb:.1}},Oe.perks={common:["Fitness","Finesse","Rapidity","Precision","Medic","Focus"],uncommon:["Concentration","Swiftness","Fluidity","Faith","Combat Veteran","Efficacious"],rare:["Dexterity","Brutality","Ethereal","Perspicuous","Vitality"],epic:["Iridescence","Fine Raiment","Royal Armorer","Whirlwind"],legendary:["Salvation","Eternal Victory","Perfectionist","Effervescence","Opalescence"]};var ke=function e(){Object(u.a)(this,e)};ke.durations={round:74,day:6800};var we,xe,Ee=new(ye=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(u.a)(this,n),(e=t.call(this,"The Arena")).events=new E,e.eventIds=new P,e.metrics={"challenge rating":function(){return e.challengeRating}},e.heroIds=new P,e.metricGrain=150,e.manual=new je;return["day","step","li","gil","kill","victory","death","tpk"].forEach((function(t){return e.resources.create(t)})),e.people.create("Adventurers"),e.spawnHero("Fighter"),Object.keys(Oe.characterClasses).forEach((function(t){e.actions.create({name:"Hire ".concat(t),act:function(){return e.spawnHero(t)}})})),e.actions.create({name:"Hire Party",act:function(){for(var t=0;t<3;t++)e.spawnHero(B(Object.keys(Oe.characterClasses)))}}),e.people.create("Enemies"),e.spawnEnemyParty(),e.evolve(e.tick),e}return Object(l.a)(n,[{key:"enemyInjured",value:function(e,t){this.events.add({id:this.eventIds.next,kind:"enemy-injured",enemyName:e,amount:t,at:this.ticks})}},{key:"turnStarted",value:function(){this.events.add({id:this.eventIds.next,kind:"turn-started",at:this.ticks})}},{key:"spawnHero",value:function(e){var t="".concat(e," (").concat(this.heroIds.next,")"),n=this.party.create(t);Oe.generate(n,e)}},{key:"challengeRating",get:function(){if(0===this.party.count)return-1;var e=this.party.list().map((function(e){return e.things.count("level")})).reduce((function(e,t){return e+t})),t=1+this.resources.count("step")/1250+this.resources.count("day")/14+this.party.count+e/this.party.count;return Math.floor(t)}},{key:"recent",value:function(e){return this.recentEvents.filter(y("kind",e))}},{key:"damagePerTick",get:function(){var e=this.recent("enemy-injured").map((function(e){return e.amount})).reduce((function(e,t){return e+t}),0);return Math.floor(e/this.metricGrain)}},{key:"recentEvents",get:function(){var e=this;return this.events.items.filter((function(t){return t.at>e.ticks-e.metricGrain}))}},{key:"spawnEnemyParty",value:function(){if(0!==this.party.count)for(var e=0;e<F(1,2+this.party.count);e++){var t=this.enemies.create("new enemy");this.manual.generate(t,this.challengeRating)}}},{key:"party",get:function(){return this.people.lookup("Adventurers")}},{key:"enemies",get:function(){return this.people.lookup("Enemies")}},{key:"injure",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=Math.floor(Math.min(e.things.count("hp"),t));if(!(r<=0)){e.things.remove(r,"hp"),this.enemies.list().includes(e)&&this.enemyInjured(e.name,r),console.log("".concat(n.name," hit ").concat(e.name," for ").concat(r,"!"));var i=Math.min(this.effective(n,"absorb"),r);if(i>0){var s=F(0,i);console.log("".concat(n.name," absorbed ").concat(s," hp!")),this.heal(n,s)}if(e.things.count("hp")>0){var o=Math.min(this.effective(e,"reflect"),r);o>0&&!a&&(console.log("".concat(e.name," reflected ").concat(o," damage!")),this.injure(n,o,e,!0));var c=this.effective(e,"counter");F(0,100)<c&&(console.log("".concat(e.name," counter-attacked against ").concat(n.name,"!")),this.strike(e,n))}}}},{key:"effective",value:function(e,t){var n=e.things.count(t);if(0===n)return 0;var a=1;return Object.keys(Oe.perkBenefits).forEach((function(n){var r=Oe.perkBenefits[n];if(Object.keys(r).includes(t)){var i=e.traits.count(n);if(i>0){var s=r[t]*i;a+=s}}})),Math.floor(n*a)}},{key:"strike",value:function(e,t){var n=this.effective(t,"holy defense"),a=Math.max(0,this.effective(e,"holy damage")-n),r=this.effective(t,"magic defense"),i=Math.max(0,this.effective(e,"magic damage")-r),s=0,o=!1,c=1+this.effective(t,"evasion");if(F(0,100)>Math.min(95,2*c)){var u=this.effective(t,"defense"),l=Math.max(1,this.effective(e,"strength")-u),h=this.effective(e,"bonus damage"),d=1+this.effective(e,"crit chance");(o=F(0,100)<Math.max(50,2*d))&&console.log("".concat(e.name," landed a critical strike on ").concat(t.name,"!")),s=o?l+h+F(1,this.effective(e,"crit damage")):F(1,l)+h}var p=i+s+a;p>0?this.injure(t,p,e):console.log("".concat(e.name," swung for ").concat(t.name," but missed!"))}},{key:"attack",value:function(e,t){var n=this;e.list().forEach((function(e){var a=Math.min(12,e.things.count("speed")),r=1+Math.floor(Math.max(12-a,0));if(n.ticks%r===0){var i=n.effective(e,"damage to all");i>0&&t.list().forEach((function(t){var a=F(1,i);n.injure(t,a,e)}));var s=B(t.list());if(s){var o=function(){return n.strike(e,s)};o();for(var c=n.effective(e,"chain chance"),u=1+n.effective(e,"max chain"),l=0;l++<u;){F(0,100)<c&&(console.log("...and swung again (".concat(l," times)!")),o())}}}}))}},{key:"heal",value:function(e,t){var n=e.things.count("hp"),a=e.things.count("max hp")-n,r=Math.min(a,t);e.things.add(Math.floor(r),"hp")}},{key:"per",value:function(e){var t=this;this.party.list().forEach((function(n){var a=t.effective(n,"xp per ".concat(e))*(1+.1*n.traits.count("Perspicuous"))*(1+.25*n.traits.count("Perfectionist"));n.things.add(Math.floor(a),"xp");var r=t.effective(n,"gold per ".concat(e))*(1+.25*n.traits.count("Perfectionist"));if(t.resources.add(Math.floor(r),"gil"),n.things.count("hp")<n.things.count("max hp")){var i=t.effective(n,"hp per ".concat(e))*(1+.25*n.traits.count("Perfectionist"));t.heal(n,i)}}))}},{key:"round",value:function(){var e=this;this.per("round"),this.party.list().forEach((function(t){var n=e.effective(t,"regen");if(e.heal(t,n),t.things.count("heal")&&e.party.list().forEach((function(n){var a=e.effective(t,"heal");e.heal(n,F(1,a))})),t.traits.count("Potion of Life")>0&&t.things.count("hp")<.5*t.things.count("max hp")){console.log("".concat(t.name," drank a potion of life!")),t.traits.remove(1,"Potion of Life");var a=20+F(0,10)+e.effective(t,"heal");e.heal(t,a)}})),this.enemies.list().forEach((function(t){e.heal(t,e.effective(t,"regen"))}))}},{key:"tick",value:function(e,t){var n=e.resources;if(this.party.list().forEach((function(e){var t=e.things.count("level"),n=Math.floor(Math.pow(2,5+t));e.things.count("xp")>n&&(e.things.remove(n,"xp"),e.things.add(1,"level"),console.log("".concat(e.name," level up!")),Oe.levelUp(e))})),t%ke.durations.round===0&&this.round(),t%ke.durations.day===0&&(n.add(1,"day"),this.per("day")),0===this.enemies.count&&this.party.count>0){if(t%5===0){if(this.resources.add(1,"step"),this.per("step"),this.resources.count("step")%500===0){n.add(1,"li"),this.per("li");for(var a=F(0,20)>19?["Shell Matrix","Cloaking Robe of Elvenkind","Counterweight"]:["Potion of Life","Healing Salve"];this.resources.count("gil")>1e3;){B(this.party.list()).traits.add(1,B(a)),this.resources.remove(1e3,"gil")}}var r=60+this.resources.count("li")+this.party.count;F(0,100)>r&&(this.spawnEnemyParty(),this.per("encounter"))}}else this.turnStarted(),this.per("turn"),this.attack(this.party,this.enemies),this.attack(this.enemies,this.party),this.mortalityCheck(n)}},{key:"mortalityCheck",value:function(e){var t=this;this.party.list().forEach((function(n){n.things.count("hp")<=0&&(n.traits.count("Eternal Victory")>0?(t.heal(n,200),n.traits.remove(1,"Eternal Victory")):n.traits.count("Healing Salve")>0?(t.heal(n,100),n.traits.remove(1,"Healing Salve")):n.traits.count("Shell Matrix")>0?(t.heal(n,50),n.things.add(150,"magic hp"),n.traits.remove(1,"Shell Matrix")):(t.per("death"),t.party.destroy(n.name),e.add(1,"death"),console.log("".concat(n.name," was slain!")),0===t.party.count&&(t.per("tpk"),e.add(1,"tpk"),console.log("The party has fallen... The quest is lost."))))})),this.enemies.list().forEach((function(n){if(n.things.count("hp")<=0&&(t.per("kill"),t.enemies.destroy(n.name),e.add(1,"kill"),console.log("".concat(n.name," was slain!")),0===t.enemies.count))return t.per("victory"),e.add(1,"victory"),void console.log("The party was victorious! The quest continues...")}))}}]),n}(Y),Object(g.a)(ye.prototype,"spawnHero",[b.a],Object.getOwnPropertyDescriptor(ye.prototype,"spawnHero"),ye.prototype),Object(g.a)(ye.prototype,"spawnEnemyParty",[b.a],Object.getOwnPropertyDescriptor(ye.prototype,"spawnEnemyParty"),ye.prototype),Object(g.a)(ye.prototype,"tick",[b.a],Object.getOwnPropertyDescriptor(ye.prototype,"tick"),ye.prototype),ye),Pe=(we=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(u.a)(this,n),(e=t.call(this,"A Society")).resourceNames=["Wheat","Bread","Wine","Water","Clay","Coal"],e.animalNames=["Sheep","Cow"],e.treeNames=["Pine","Spruce"],e.fruitTreeNames=["Pear","Cherry"],e.plantNames=["Grape","Blueberry"],e.strataNames=["Nobility","Merchants","Workers","Farmers"],e.meatNames={Cow:"Beef",Chicken:"Poultry",Pig:"Pork",Sheep:"Mutton"},e.setup(),e}return Object(l.a)(n,[{key:"setup",value:function(){var e=this;this.strataNames.forEach((function(t){var n=e.people.create(t);n.birth(),n.birth(),n.birth()})),this.resourceNames.forEach((function(t){return e.resources.create(t)})),this.animalNames.forEach((function(t){e.animals.create(t).birth(),e.resources.create(e.meatNames[t])})),this.treeNames.forEach((function(t){e.resources.create("".concat(t," Wood")),e.resources.create("".concat(t," Tree")),e.resources.create("".concat(t," Seed"))})),this.fruitTreeNames.forEach((function(t){e.resources.create("".concat(t," Wood")),e.resources.create("".concat(t," Tree")),e.resources.create("".concat(t," Seed")),e.resources.create("".concat(t))})),this.plantNames.forEach((function(t){e.resources.create("".concat(t," Plant")),e.resources.create("".concat(t," Seed")),e.resources.create("".concat(t))})),this.evolve(this.evolution)}},{key:"evolution",value:function(e,t){var n=this,a=e.resources,r=e.animals;this.animalNames.forEach((function(e){F(0,20)>18&&r.add(1,e)})),this.people.lookup("Workers").list().forEach((function(e){var t=B(n.treeNames);a.count("".concat(t," Tree"))>0&&(a.add(F(2,3),"".concat(t," Wood")),a.add(F(0,1),"".concat(t," Seed")),a.remove(1,"".concat(t," Tree")))})),this.people.lookup("Farmers").list().forEach((function(e){var t=B(n.animalNames);r.remove(1,t),a.add(1,n.meatNames[t]);var i=B(n.plantNames);a.count("".concat(i," Plant"))>0?(a.remove(1,"".concat(i," Plant")),a.add(1,i)):(a.add(1,"".concat(i," Plant")),a.remove(1,"".concat(i," Seed")))}))}}]),n}(Y),Object(g.a)(we.prototype,"evolution",[b.a],Object.getOwnPropertyDescriptor(we.prototype,"evolution"),we.prototype),we),Ce=n(11);var Se=(xe=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,"".concat(e," Factory"))).events=new D,a.bills=new E,a.metrics={"Production Speed":function(){return a.deliveryRate},"Total Fulfillments":function(){return a.fulfillmentEvents.length},"Orders In Queue":function(){return a.bills.count}},a.metricGrain=100,a.produce=function(e,t){if(a.canProduce(t))a.workers.jobs.set(e,t);else if(t.consumes){var n=[];Object.entries(t.consumes).forEach((function(e){var t=Object(w.a)(e,2),r=t[0],i=t[1];a.resources.count(r)<i&&n.push(r)}));var r=n[F(0,n.length)],i=null;a.workers.recipes.each((function(e){e.produces[r]&&(i=e)})),i&&a.produce(e,i)}},a.missingRequirements=function(e){var t=[];return e.consumes&&Object.entries(e.consumes).forEach((function(e){var n=Object(w.a)(e,2),r=n[0],i=n[1];a.resources.count(r)<i&&t.push(r)})),t},a.canProduce=function(e){var t=!0;return e.consumes&&Object.entries(e.consumes).forEach((function(e){var n=Object(w.a)(e,2),r=n[0],i=n[1];a.resources.count(r)<i&&(t=!1)})),t},a.evolution=function(e){var t=e.resources;a.manage(t),a.bills.count>0&&a.workers.work({resources:t})},a.orderIds=new P,a}return Object(l.a)(n,[{key:"emit",value:function(e,t,n){this.events.create({name:t,description:n,kind:e,at:this.ticks})}},{key:"deliveryRate",get:function(){return this.recentEvents.filter(y("kind","order:fulfilled")).length/this.metricGrain}},{key:"recentEvents",get:function(){var e=this;return this.events.list().filter((function(t){return t.at>e.ticks-e.metricGrain}))}},{key:"fulfillmentEvents",get:function(){return this.events.list().filter(y("kind","order:fulfilled"))}},{key:"product",value:function(e,t){var n=this;this.actions.create({name:"Order ".concat(e),act:function(t){var a=t.count,r=t.deliverTo;n.order(a||20,e,r||{receive:function(){return 1}})}}),this.resources.create(e),this.workers.recipes.create({name:e,produces:Object(Ce.a)({},e,1),consumes:t})}},{key:"reboot",value:function(){var e=this;this.reset(),this.people.create("Workers"),this.bills.clear(),this.evolve(this.evolution),this.policies.create({name:"FIFO",manage:function(){var t=e.unfulfilled(e.bills.first)[0],n=e.workers.recipes.lookup(t);n&&e.workers.list().forEach((function(t){return e.produce(t,n)}))}}),this.policies.create({name:"Round Robin",manage:function(){var t=function(e){for(var t={},n=[],a=0,r=e.length;a<r;++a)t.hasOwnProperty(e[a])||(n.push(e[a]),t[e[a]]=1);return n}(e.bills.items.flatMap((function(t){return e.unfulfilled(t)})));e.workers.list().forEach((function(n,a){var r=t[a%t.length],i=e.workers.recipes.lookup(r);i&&e.produce(n,i)}))}}),this.choose("FIFO")}},{key:"unfulfilled",value:function(e){var t=this;if(void 0===e)return[];var n=Object.keys(e.order),a=[];return n.forEach((function(n){var r=e.order[n];t.resources.count(n)<r&&a.push(n)})),a}},{key:"order",value:function(e,t,n){var a={id:this.orderIds.next,order:Object(Ce.a)({},t,e),account:n,price:e};return this.bills.add(a),a}},{key:"workers",get:function(){return this.people.lookup("Workers")}},{key:"manage",value:function(e){var t=this;0!==this.bills.count&&(this.bills.each((function(e){var n=Object.keys(e.order);0===t.unfulfilled(e).length&&(e.account.receive([],e),n.forEach((function(n){t.resources.remove(e.order[n],n)})),t.bills.remove(e),t.emit("order:fulfilled","An order for ".concat(n.join(",")," has been fulfilled")))})),this.currentPolicy?this.currentPolicy.manage():console.warn("No labor policy selected!"))}}]),n}(Y),Object(g.a)(xe.prototype,"reboot",[b.a],Object.getOwnPropertyDescriptor(xe.prototype,"reboot"),xe.prototype),xe),Me=new P,Ne=new Se("Zep");Ne.reboot(),Ne.product("Soles",{}),Ne.product("Laces",{}),Ne.product("Socks",{}),Ne.product("Shoes",{Soles:2,Laces:2}),Ne.product("Hat",{}),Ne.product("Belt",{}),Ne.product("Underwear",{}),Ne.product("Pants",{}),Ne.product("Outfit",{Pants:1,Belt:1,Hat:1,Socks:1,Shoes:1});var Ie=Ne.people.create("Management");Ie.create("Operations Chief"),Ie.create("Plant Manager"),Ne.machines.create("Robot"),Ne.actions.create({name:"Spawn Worker",act:function(){Ne.workers.create("Employee #".concat(Me.next))}});var De=[Ee,Ne,se,Pe];var Fe=function(e){var t=e.model;return Object(Q.jsx)("div",{className:"App",children:Object(Q.jsx)(re,{models:De,initialModel:t})})};s.a.render(Object(Q.jsx)(r.a.StrictMode,{children:Object(Q.jsx)(Fe,{model:Ee})}),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.acabf3f9.chunk.js.map